[ { "title": "åˆè®°ä¸€æ¬¡å¤æ‚é¡¹ç›®è¿ç§»", "url": "/posts/%E5%8F%88%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E8%BF%81%E7%A7%BB/", "categories": "", "tags": "è¿ç»´, python, fastdfs", "date": "2024-06-13 00:20:45 +0800", "snippet": "å‰è¨€æ˜¯çš„ï¼Œé¡¹ç›®è¿ç§»å®ƒåˆæ¥äº†ï¼Œè¿˜æ˜¯22å¹´é‚£ä¸ªé¡¹ç›®ï¼Œä¸åŒçš„æ˜¯å…¬å¸ä¸Šäº†devopsï¼Œæ‰€æœ‰ç»„ä»¶éƒ½å®¹å™¨åŒ–äº†ï¼Œå…å»äº†å®‰è£…çš„è¿‡ç¨‹ï¼Œä½†æ˜¯æ–‡ä»¶è¿˜å¾—è¿ç§»é‚£ï¼Œåˆæ˜¯ç½ªæ¶æ»”å¤©çš„fdfsï¼Œæ–‡ä»¶å­˜çš„å¾ˆå‡Œä¹±ï¼Œæœ‰çš„åœ¨å¯Œæ–‡æœ¬é‡Œæœ‰çš„åœ¨ç»“æ„åŒ–æ•°æ®åº“é‡Œï¼Œä½†ä¸åŒçš„æ˜¯æˆ‘å­¦ä¼šäº†pythonï¼ŒpyçœŸçš„å¤©ä¸‹ç¬¬ä¸€,å¤ªæ–¹ä¾¿äº†å®¶äººä»¬ã€‚è¿™æ¬¡è§£å†³é—®é¢˜çš„æ€è·¯å¦‚ä¸‹: å¯¼å‡ºå…¨é‡sql pythonæ­£åˆ™é€‰å–æ–‡ä»¶url [re] ä¸‹è½½å†ä¸Šä¼  [requestsã€fdfs-client-py3==1.0.0] å…¨å±€æ›¿æ¢æ–‡ä»¶url [pathlib2==2.3.7.post1] è¿›åº¦æ¡è¾“å‡º[tqdm==4.66.4]ç›¸è¾ƒäº22å¹´çš„é‚£æ¬¡è¿ç§»ï¼Œè¿™æ¬¡é¿å…äº†æ•°æ®åº“äº¤äº’ï¼Œè¿ç”¨äº†pyï¼Œæå¤§åœ°æå‡äº†æ•ˆç‡ä»£ç éƒ¨åˆ†1. é¦–å…ˆç»™åˆ°çš„æ˜¯fdfsä¸Šä¼ éƒ¨åˆ†ï¼Œéœ€è¦ä¸¤ä¸ªé…ç½®æ–‡ä»¶å¯¹åº”Aå’ŒB fdfså®¢æˆ·ç«¯ï¼Œpy3ä¸‹è½½ä¼šæœ‰ç‚¹é—®é¢˜ï¼Œæ‰€ä»¥ç”¨äº†requeståº“ä¸‹è½½Aå®¢æˆ·ç«¯æ–‡ä»¶æµï¼Œå†ä¼ åˆ°Bå®¢æˆ·ç«¯,è¿”å›ä¸€ä¸ªå¯ä»¥ç›´æ¥è®¿é—®çš„nginxåœ°å€# -*- coding: utf-8 -*-import tracebackfrom fdfs_client.client import Fdfs_clientimport requestsimport loggingnginx_url = &#39;xxx:8888&#39;logging.captureWarnings(True)class FastDFSHandler: def __init__(self, client_file_a, client_file_b): self.client_a = self.create_client(client_file_a) self.client_b = self.create_client(client_file_b) def create_client(self, client_file): try: client = Fdfs_client(client_file) return client except Exception as e: print(f&quot;FastDFS Create client fail: {e}&quot;) return None def download_from_a_upload_to_b(self, file_id, extname): try: # Download from A FastDFS # ret_download = self.client_a.download_to_buffer(file_id) # if not ret_download: # print(f&quot;Failed to download file from A FastDFS (File ID: {file_id})&quot;) # return False # Upload to B FastDFS ret_upload = self.client_b.upload_by_buffer(requests.get(file_id, verify=False).content, ) # ret_upload = self.client_b.upload_by_buffer(ret_download[&#39;Content&#39;], # file_ext_name=extname) if not ret_upload: print(f&quot;Failed to upload file to B FastDFS&quot;) return False url = nginx_url + ret_upload[&#39;Remote file_id&#39;] # print(f&quot;File successfully transferred from A to B FastDFS (File ID: {url})&quot;) return url except Exception as e: print(f&quot;Error during transfer: {e}&quot;) return &#39;&#39;def init(): # ä½ éœ€è¦æä¾› A å’Œ B FastDFS çš„é…ç½®æ–‡ä»¶è·¯å¾„ client_file_a = &quot;client_a.conf&quot; client_file_b = &quot;client_b.conf&quot; handler = FastDFSHandler(client_file_a, client_file_b) return handler# ä½¿ç”¨ç¤ºä¾‹# if __name__ == &quot;__main__&quot;:# client_file_a = &quot;client_a.conf&quot;# client_file_b = &quot;client_b.conf&quot;# handler = FastDFSHandler(client_file_a, client_file_b)# # ä» A FastDFS ä¸‹è½½å¹¶ä¸Šä¼ åˆ° B FastDFS# handler.download_from_a_upload_to_b(source_file_id)å®¢æˆ·ç«¯ç¤ºä¾‹# connect timeout in seconds# default value is 30sconnect_timeout=10# network timeout in seconds# default value is 30snetwork_timeout=10# tracker_server å¯ä»¥å‡ºç°å¤šæ¬¡ï¼Œæ ¼å¼ä¸º &quot;host:port&quot;ï¼Œhost å¯ä»¥æ˜¯ä¸»æœºåæˆ– IP åœ°å€tracker_server=xxxx:22122# standard log level as syslog, case insensitive, value list:# emerg for emergency# alert# crit for critical# error# warn for warning# notice# info# debuglog_level=debug2.æ¥ä¸‹æ¥æ˜¯å¯¹sqlæ–‡ä»¶çš„æ­£åˆ™æŸ¥æ‰¾ä»¥åŠæ›¿æ¢import re# ä»pathlib2æ¨¡å—å¯¼å…¥Pathfrom pathlib2 import Pathimport fastdfs_trans1 as fastdfs_transfrom tqdm import tqdmfile_path = &quot;2024-06-12tablecontent.sql&quot;# åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥æ›¿æ¢æ–‡æœ¬def replacetext(search_text, replace_text): # ä½¿ç”¨Pathå‡½æ•°æ‰“å¼€æ–‡ä»¶ file = Path(file_path) # è¯»å–æ–‡ä»¶å†…å®¹å¹¶å°†å…¶å­˜å‚¨åœ¨æ•°æ®å˜é‡ä¸­ data = file.read_text() # ä½¿ç”¨æ›¿æ¢åŠŸèƒ½æ›¿æ¢æ–‡æœ¬ data = data.replace(search_text, replace_text) # åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­å†™å…¥æ›¿æ¢çš„æ•°æ® file.write_text(data) return &quot;æ–‡æœ¬å·²æ›¿æ¢&quot;def is_valid_url(string): regex = r&#39;^(http?://)?\\S+$&#39; return re.match(regex, string, re.IGNORECASE) is not Nonedef copyPic(): # æ‰“å¼€åŒ…å«ç½‘å€çš„æ–‡æœ¬æ–‡ä»¶ï¼ˆurls.txtï¼‰ with open(file_path, &quot;r&quot;) as file: content = file.read() # åŒ¹é…ä»¥æŒ‡å®šå­—ç¬¦ä¸²å¼€å¤´å¹¶ä»¥ &#39; ç»“å°¾çš„æ­£åˆ™è¡¨è¾¾å¼ pattern = r&#39;(https://å…³é”®è¯/.+?)\\\\&quot;&#39; urls = re.findall(pattern1, content) handle = fastdfs_trans.init() for url in tqdm(urls): try: # åˆ¤æ–­urlæ˜¯å¦åˆæ³• if is_valid_url(url): # print(f&quot;æ‰¾åˆ°ç½‘å€ï¼š{url}&quot;) # ä¸Šä¼  resultUrl = handle.download_from_a_upload_to_b(url, extname=url.split(&#39;.&#39;)[-1]) # æ–‡æœ¬æ›¿æ¢ replacetext(url, resultUrl) except Exception as e: print(f&quot;Error during copy: {e}&quot;) print(f&#39;é”™è¯¯åœ°å€:{url}&#39;)if __name__ == &#39;__main__&#39;: copyPic()3.è¾“å‡ºç¾åŒ– ç”¨åˆ°äº† tqdm ä¼šç”Ÿæˆæ¯”è¾ƒä¼˜ç¾çš„è¿›åº¦æ¡## æ€»ç»“ ä¸‹æ¬¡é¡¹ç›®æ–‡ä»¶ç®¡ç†ä¸€å®šç”¨minioï¼ è¿˜æœ‰ä¸ªé—®é¢˜ requeståšä¸‹è½½è¦å¸¦ä¸Šæµè§ˆå™¨headerï¼Œå…¬å¸åŸŸååšäº†é™åˆ¶ï¼ ä»¥åŠcopilotå¤©ä¸‹ç¬¬ä¸€ï¼Œä»¥ä¸Šä»£ç éƒ½æ˜¯ç›´æ¥é¢å‘AIå¼€å‘ã€‚" }, { "title": "ã€æºç åˆ†æã€‘logbackæ—¥å¿—é…ç½®åŠå­˜å‚¨", "url": "/posts/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-logback%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%AD%98%E5%82%A8/", "categories": "", "tags": "springboot, logback", "date": "2024-04-11 11:12:07 +0800", "snippet": "èµ·å›  linuxç³»ç»Ÿä¸­springbootæ—¥å¿—æ–‡ä»¶é»˜è®¤å­˜åœ¨/tmpä¸‹ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå­˜å‚¨åœ¨è¿™ä¸ªä½ç½®å‘¢,æŸ¥é˜…å¯çŸ¥ org/springframework/boot/logging/logback/base.xml è¿›è¡Œäº†ç›¸å…³å®šä¹‰ åŒæ—¶æŸ¥çœ‹logbackæ—¥å¿—é…ç½®æ–‡ä»¶ä¼šæœ‰ç–‘é—®ï¼Œæœ‰äº›å˜é‡å–è‡ªäºdefauts.xmlä¸­è‡ªå®šä¹‰ï¼Œè¿™äº›æ—¥å¿—ä¸­çš„å˜é‡åˆ°åº•å“ªé‡Œæ¥çš„å‘¢ã€‚ æºç åˆ†æAbstractLoggingSystem LogbackLoggingSystem LogbackLoggingSystem LogbackLoggingSystem " }, { "title": "pythonå¾®ä¿¡è‡ªåŠ¨åŒ–æ¡†æ¶wxautoè¿›è¡Œæ¶ˆæ¯é‡‡é›†è½¬å‘", "url": "/posts/python%E5%BE%AE%E4%BF%A1%E8%87%AA%E5%8A%A8%E5%8C%96%E6%A1%86%E6%9E%B6wxauto%E8%BF%9B%E8%A1%8C%E6%B6%88%E6%81%AF%E9%87%87%E9%9B%86%E8%BD%AC%E5%8F%91/", "categories": "", "tags": "å¾®ä¿¡è‡ªåŠ¨åŒ–, wxauto, python", "date": "2024-03-07 16:07:37 +0800", "snippet": "éœ€æ±‚ é‡‡é›†å¤§ç¾¤ä¸­å«å…³é”®è¯çš„èŠå¤©è®°å½•ï¼Œå¹¶è¿›è¡Œè‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†ã€Œè„±æ•ã€æ·»åŠ ã€ï¼Œç„¶åè½¬å‘è‡³æŒ‡å®šç¾¤èŠï¼›åŒæ—¶å­˜å‚¨ä¿¡æ¯è‡³redis keyä¸ºå½“å¤©æ—¥æœŸçš„setï¼Œåˆ¤é‡å‘é€ å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©å®šæ—¶å‘é€å…¬å‘Šï¼Œå…¬å‘Šæ–‡ä»¶ä¸ºtxtç¯å¢ƒå¾®ä¿¡ç‰ˆæœ¬: 3.9.8.15pythonç‰ˆæœ¬: 3.11.6wxautoç‰ˆæœ¬: 3.9.8æœåŠ¡å™¨ç‰ˆæœ¬: é˜¿é‡Œäº‘ 2æ ¸4g windows 2012æºç from wxauto import WeChatimport timeimport reimport hashlibimport redisimport datetimeimport schedule# å®ä¾‹åŒ–å¾®ä¿¡å¯¹è±¡wx = WeChat()listen_list = [ &#39;é‡‡é›†ç¾¤1&#39;]# è½¬å‘ç›®æ ‡ç¾¤target_list = [ #&#39;test&#39;,]# æ–‡æœ«ä¿¡æ¯end_text = &quot;æ¥å•è¯·è”ç³»ç¾¤ä¸» ğŸ“1234567890&quot;pool = redis.ConnectionPool(host=&#39;127.0.0.1&#39;, port=6379, decode_responses=True)def listen_group_chat(): for i in listen_list: wx.AddListenChat(who=i, savepic=False) # æ·»åŠ ç›‘å¬å¯¹è±¡å¹¶ä¸”è‡ªåŠ¨ä¿å­˜æ–°æ¶ˆæ¯å›¾ç‰‡ # æŒç»­ç›‘å¬æ¶ˆæ¯ wait = 10 # è®¾ç½®10ç§’æŸ¥çœ‹ä¸€æ¬¡æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ while True: msgs = wx.GetListenMessage() print(f&#39;é‡‡é›†æ—¶é—´ï¼š{datetime.datetime.now().strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)}&#39;) for chat in msgs: msg = msgs.get(chat) # è·å–æ¶ˆæ¯å†…å®¹ print(f&#39;\\n-----&amp;gt;å·²è·å–æ–°çš„æ¶ˆæ¯,é‡‡é›†æºï¼š{chat.who}&#39;) # è·å–æ¯æ¡èŠå¤©ä¿¡æ¯ for msg_item in msg: # åˆ¤æ–­æ˜¯å¦åŒ…å«å…³é”®è¯ msg_content = msg_item[1] print(f&#39;æ¶ˆæ¯å†…å®¹:{msg_item}\\n&#39;) if keyword_match(msg_content): # åˆ¤æ–­redisä¸­æ˜¯å¦å­˜åœ¨ if not check_value(msg_content): print(&quot;å¼€å§‹è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†&quot;) # æ¶ˆæ¯è„±æ•å¤„ç† cleaned_text = msg_handler(msg_content) print(f&quot;å¤„ç†ç»“æœ:{cleaned_text}&quot;) # è½¬å‘è‡³å…¶ä»–ç¾¤ trans_to_another_group(target_list, cleaned_text) # redisç¼“å­˜ set_cache(msg_content) print(&quot;-----&amp;gt;æ¶ˆæ¯å·²ç¼“å­˜,å¤„ç†ç»“æŸ\\n&quot;) else: print(&quot;-----&amp;gt;å½“æ—¥æ¶ˆæ¯å·²å­˜åœ¨ï¼Œ ä¸ä½œå¤„ç†\\n&quot;) else: print(&quot;-----&amp;gt;æ¶ˆæ¯ä¸åŒ…å«å…³é”®è¯ï¼Œ ä¸ä½œå¤„ç†\\n&quot;) schedule.run_pending() time.sleep(wait)# è½¬å‘è‡³å…¶ä»–ç¾¤def trans_to_another_group(group_names, msg, at=None): print(f&quot;å³å°†å¼€å§‹æ¶ˆæ¯è½¬å‘&quot;) for group_name in group_names: wx.ChatWith(group_name) if at: wx.AtSomeOne(msg, at) else: wx.SendMsg(msg) print(f&quot;æ¶ˆæ¯å·²è½¬å‘è‡³{group_name}&quot;)# æ¶ˆæ¯å¤„ç†å™¨def msg_handler(text): # å»é™¤åŸæœ‰æ‰‹æœºå· phone_pattern = &quot;1[3-9]\\d{9}&quot; cleaned_text = re.sub(phone_pattern, &quot;&quot;, text) return f&#39;{cleaned_text}\\n{end_text}&#39;# å…³é”®è¯åŒ¹é…def keyword_match(text): # å®šä¹‰è¦åŒ¹é…çš„å…³é”®è¯åˆ—è¡¨ keywords = [&quot;key1&quot;, &quot;key2&quot;, &quot;key3&quot;] xiaoqu_keywords = [&#39;area1&#39;, &#39;area2&#39;, &#39;area3&#39;] # æ„å»ºæ­£åˆ™è¡¨è¾¾å¼ pattern = r&#39;|&#39;.join(map(re.escape, keywords + xiaoqu_keywords)) # è¿›è¡ŒåŒ¹é…å¹¶è¾“å‡ºç»“æœ matches = re.findall(pattern, text) if len(matches) &amp;gt; 0: return True else: return False# md5åŠ å¯†def md5_encode(text): md = hashlib.md5(text.encode()) # åˆ›å»ºmd5å¯¹è±¡ md5pwd = md.hexdigest() # md5åŠ å¯† return md5pwd# redis setèµ‹å€¼ è¿‡æœŸé»˜è®¤24å°æ—¶def set_cache(value, timeout=24 * 60 * 60): r = redis.Redis(connection_pool=pool) key = datetime.datetime.now().strftime(&quot;%Y%m%d&quot;) r.sadd(key, value)# åˆ¤æ–­redisä¸­setå€¼æ˜¯å¦å­˜åœ¨def check_value(value): key = datetime.datetime.now().strftime(&quot;%Y%m%d&quot;) r = redis.Redis(connection_pool=pool) return r.sismember(key, value) != 0# å¹¿å‘Šæ’­æŠ¥def notice_broadcast(): file_path = &#39;notice1.txt&#39; try: # æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–æ‰€æœ‰è¡Œï¼ˆåŒ…æ‹¬æ¢è¡Œç¬¦ï¼‰ with open(file_path, &#39;r&#39;, encoding=&#39;utf-8&#39;) as file: content = file.read() trans_to_another_group(target_list, content) except FileNotFoundError: print(&quot;æœªæ‰¾åˆ°è¯¥æ–‡ä»¶&quot;) except Exception as e: print(&quot;å‘ç”Ÿé”™è¯¯: &quot;, str(e))def schedule_init(): # æ¸…ç©ºä»»åŠ¡ schedule.clear() # åˆ›å»ºä¸€ä¸ªæŒ‰3ç§’é—´éš”æ‰§è¡Œä»»åŠ¡ schedule.every().day.at(&quot;06:00&quot;).do(notice_broadcast) schedule.every().day.at(&quot;12:00&quot;).do(notice_broadcast) schedule.every().day.at(&quot;18:00&quot;).do(notice_broadcast) schedule.every().day.at(&quot;21:00&quot;).do(notice_broadcast)if __name__ == &#39;__main__&#39;: #éœ€è¦æ³¨æ„ å¼€å¯å®šæ—¶ä»»åŠ¡éœ€è¦åœ¨ç›‘è§†å¾ªç¯å†… å¹¶ä¸”åˆå§‹åŒ–æœ‰å…ˆåé¡ºåº schedule_init() listen_group_chat()æ•ˆæœå›¾å¾…ä¼˜åŒ– æ—¥å¿—æ–‡ä»¶è¾“å‡º è®°å½•å…¥åº“ å…¬å‘Šåœ¨çº¿å‘å¸ƒå¸¸è§é—®é¢˜ æŠ¥é”™ ä¸€èˆ¬æ˜¯pythonç‰ˆæœ¬å·é—®é¢˜ æ­¤å·¥å…·éœ€è¦ä¿æŒè¿œç¨‹è¿æ¥ï¼Œå‰å°è¿è¡Œhookï¼Œwindowsè‡ªå¸¦å·¥å…·ä¸å¯ç”¨ï¼Œæœ¬äººä½¿ç”¨todeskï¼Œå…¶ä»–è½¯ä»¶è‡ªè¡Œæœç´¢ è¿œç¨‹æ¡Œé¢äº¦å¯ï¼Œä¸è¿‡éœ€è¦æ–­å¼€è¿æ¥ä½¿ç”¨è„šæœ¬ä¿è¯ä¸é€€å‡ºæ¡Œé¢ï¼Œæ–°å»º exit.batï¼Œæ¯æ¬¡ç‚¹å‡»è„šæœ¬é€€å‡º``` exit.bat@echo offfor %%i in (0,1,2,3,4,5,6,7,8,9) do (tscon %%i /dest:console )```" }, { "title": "å¥‡æŠ€æ·«å·§ä¹‹oauth2åˆ©ç”¨stateä¼ å‚", "url": "/posts/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7%E4%B9%8Boauth2%E5%88%A9%E7%94%A8state%E4%BC%A0%E5%8F%82/", "categories": "", "tags": "oauth2", "date": "2023-08-22 16:12:25 +0800", "snippet": "é—®é¢˜å…¬å¸å¤šä¸ªå­ç³»ç»Ÿè°ƒç”¨åŒä¸€å¥—oauth2è®¤è¯ï¼Œä½†æ˜¯ç³»ç»Ÿä¹‹é—´tokenæ˜¯è‡ªå®šä¹‰çš„ï¼Œç°åœ¨éœ€è¦Aè·³è½¬åˆ°BæŒ‡å®šé¡µé¢ï¼Œå•ç‚¹è®¤è¯ä¹‹åè·³è½¬çš„åœ°å€æ˜¯å›ºå®šçš„è§£å†³åŠæ³•åˆ©ç”¨oauth2ä¸­çš„stateå‚æ•°ï¼Œoauthå®˜ç½‘ä¸Šæœ‰è¿™æ ·ä¸€æ®µ å…³äºstateæè¿°çš„å†…å®¹å¦‚æœå®¢æˆ·ç«¯å¸Œæœ›åœ¨é‡å®šå‘ URL ä¸­åŒ…å«ç‰¹å®šäºè¯·æ±‚çš„æ•°æ®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨â€œstateâ€å‚æ•°æ¥å­˜å‚¨ç”¨æˆ·é‡å®šå‘åå°†åŒ…å«çš„æ•°æ®ã€‚ å®ƒå¯ä»¥å¯¹çŠ¶æ€å‚æ•°æœ¬èº«ä¸­çš„æ•°æ®è¿›è¡Œç¼–ç ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨çŠ¶æ€å‚æ•°ä½œä¸ºä¼šè¯ ID å°†çŠ¶æ€å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šã€‚æ­¥éª¤1ä¸€èˆ¬stateç”¨äºçŠ¶æ€è®¤è¯ï¼Œæ˜¯ç”¨äºé˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»ï¼Œé€šå¸¸ï¼Œstate å‚æ•°ä¼šéšç€æˆæƒè¯·æ±‚ä¸€èµ·å‘é€åˆ°æˆæƒæœåŠ¡å™¨ï¼ŒæˆæƒæœåŠ¡å™¨ä¼šåœ¨å›è°ƒæ—¶è¿”å›è¯¥å‚æ•°ï¼Œå®¢æˆ·ç«¯éœ€è¦éªŒè¯è¯¥å‚æ•°å’Œå‘é€æ—¶çš„æ˜¯å¦ä¸€è‡´ï¼Œä»¥ç¡®ä¿è¯·æ±‚ä¸æ˜¯æ¥è‡ªéæ³•çš„æ”»å‡»è€…ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨stateä¼ é€’å‚æ•°ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨oauth2è®¤è¯é“¾æ¥çš„æ—¶å€™å°†è·³è½¬åœ°å€ä¼ å…¥æ³¨æ„éœ€è¦å°†é“¾æ¥è¿›è¡Œurlç¼–ç ï¼Œä¾‹å¦‚:http%3A%2F%2Fwww.baidu.compublic String login(@RequestParam(required = false) String backUrl) { // ä¼ é€’å‚æ•°response_typeã€client_idã€stateã€redirect_uri String url = baseUrl + authorizeUrl + &quot;?response_type=code&amp;amp;&quot; + &quot;client_id=&quot; + clientId + &quot;&amp;amp;redirect_uri=&quot; + callbackUrl; //stateè®°å½•è·³è½¬url if (StrUtil.isNotBlank(backUrl)) { url = url + &quot;&amp;amp;state=&quot; + backUrl; } url = url + &quot;&amp;amp;scope=ALL&quot;; return &quot;redirect:&quot; + url; }æ­¥éª¤2ä¸Šä¸€æ­¥æˆ‘ä»¬ä¼ é€’äº†stateå‚æ•°ï¼Œé‚£ä¹ˆåœ¨å›è°ƒçš„æ—¶å€™å°±ä¼šæ¥æ”¶åˆ°stateå‚æ•°public String callback(@RequestParam(required = false) String code, @RequestParam(required = false) String state) { //â€¦â€¦æ­¤å¤„çœç•¥ä¸šåŠ¡å¤„ç† æ¢å–token è·å–ç”¨æˆ·ä¿¡æ¯ //stateä¸ä¸ºç©ºå–å‡ºé‡å®šå‘urlï¼Œæºå¸¦tokenè¿›è¡Œè·³è½¬ å¦åˆ™è·³è½¬é»˜è®¤é¦–é¡µ if (StrUtil.isNotBlank(state)) { callbackFeUrl = state; } return &quot;redirect:&quot; + callbackFeUrl + &quot;?token=&quot; + r.get(&quot;token&quot;); }æ­¥éª¤3æµ‹è¯•ä¸€ä¸‹ï¼ŒBç³»ç»Ÿæ”¹é€ ä¸ºä»¥ä¸Šä»£ç ï¼ŒAç³»ç»Ÿå‰ç«¯é¡µé¢æŒ‚è½½Bç³»ç»Ÿè·³è½¬è®¤è¯æ¥å£ http://xxxx/sso/dologin?backUrl=http%3A%2F%2Fwww.baidu.com,å®ç°è·³è½¬åˆ°ç™¾åº¦ï¼Œæ­¤å¤„ç™¾åº¦æ›¿æ¢ä¸ºBç³»ç»ŸæŒ‡å®šé¡µé¢ã€‚æ‰“å®Œæ”¶å·¥" }, { "title": "kkfileç›¸å…³é—®é¢˜è§£å†³", "url": "/posts/kkfile%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/", "categories": "", "tags": "kkfile, docker", "date": "2023-05-17 11:05:50 +0800", "snippet": "é—®é¢˜1kkfile æ— æ³•è®¿é—®è§£å†³æ–¹æ¡ˆä¸­é™„ä»¶å…·ä½“æŠ¥é”™ä¸ºæŸä¸ªæ–‡ä»¶åœ°å€ filenotfoud java.net.UnknownHostException:è§£å†³æ–¹æ³•å»æ‰docker é…ç½®æ–‡ä»¶ä¸­â€dnsâ€ : [â€œ114.114.114.114â€,â€8.8.8.8â€] åˆ™å¯ä»¥æ­£å¸¸è®¿é—® è‡³äºä¸ºä»€ä¹ˆåŠ è¿™ä¸€æ®µæ˜¯å› ä¸ºä¹‹å‰è®¿é—®ä¸äº†å¤–ç½‘æ‰åŠ çš„é—®é¢˜2dockerå®¹å™¨ä¹‹é—´äº’ç›¸è®¿é—®çš„é—®é¢˜ï¼Œkkfileéœ€è¦è®¿é—®redisï¼Œç”±äºå®¹å™¨é‡å¯ipä¸å›ºå®šè§£å†³æ–¹æ³•éœ€è¦åœ¨kkfile runçš„æ—¶å€™å°±åšå¥½é“¾æ¥ â€“link å®¹å™¨å:åˆ«å ï¼Œä¸€è‡´åˆ™ç”¨ä¸€ä¸ªå°±è¡Œdocker run --restart=always -d \\ -e KK_BASE_URL=&quot;https://m.cicdi.com/jjfapt/kkfile&quot; \\ -e KK_CONTEXT_PATH=&quot;/kkfile&quot; \\ -v /home/cicdiAdmin/env/kkfile_docker:/opt/kkFileView-4.1.0-SNAPSHOT \\ -it -p 8012:8012 --name kkfile --link redis5 keking/kkfileview:v4.0.0åŸç†æ˜¯hostä¸­å¢åŠ ä¸€æ¡æ˜ å°„åˆ°å®¹å™¨ipï¼Œç„¶åé…ç½®kkfileçš„æ–‡ä»¶ï¼ŒåŸæ¥ipåœ°å€æ”¹ä¸ºåˆ«åå³å¯spring.redisson.address = ${KK_SPRING_REDISSON_ADDRESS:redis5:6379}ç›¸å…³å‘½ä»¤vim /etc/docker/daemon.jsonsystemctl restart docker#è¿›å…¥å®¹å™¨å†…éƒ¨docker exec -it kkfile bash#æŸ¥çœ‹æ—¥å¿—docker logs --tail=1000 kkfile -f#æŸ¥çœ‹å®¹å™¨ipdocker inspect --format=&#39;{{.NetworkSettings.IPAddress}}&#39; redis-service#ä¿®æ”¹kkfileé…ç½®vim /home/xxx/env/kkfile_docker/config/application.properties" }, { "title": "easypoiä½¿ç”¨mapæ¨¡æ¿å¯¼å‡ºdictå­—å…¸è½¬æ¢", "url": "/posts/easypoi%E4%BD%BF%E7%94%A8map%E5%AF%BC%E5%87%BAdict%E5%AD%97%E5%85%B8%E8%BD%AC%E6%8D%A2/", "categories": "", "tags": "easypoi, map, dict", "date": "2023-04-19 16:19:45 +0800", "snippet": "èƒŒæ™¯æœ‰ä¸€ä¸ªå¯¼å‡ºåŸæ¥ç”¨çš„mapå¯¼å‡ºï¼Œç°åœ¨æœ‰å­—æ®µéœ€è¦åšæ•°å€¼è½¬æ¢æ¨¡æ¿å¤„ç†ç”³è¯·äººå…¬å¸ ç”³è¯·æ—¶é—´ ç”³è¯·å•å· äº§å“åç§° ç”³è¯·ç”¨æˆ· çŠ¶æ€ å›æ”¶æ ‡è®°$fe:map1 t.companyName t.create_time t.id t.productName t.creator dict:applyStatus;t.status t.recycleFlagä»¥ä¸Šä¸ºexcelæ¨¡æ¿å†…å®¹ å…¶ä¸­çŠ¶æ€å­—æ®µ dict:applyStatus;t.statusï¼Œdict ä»£è¡¨è¿™ä¸ªæ˜¯å­—æ®µå¤„ç†,applyStatus å­—å…¸keyä»£ç å¤„ç†éœ€è¦è‡ªå®šä¹‰å­—å…¸è½¬æ¢æ¥å£ï¼Œå®ç°IExcelDictHandler æ¥å£ï¼Œç„¶ååœ¨æ¨¡æ¿å‚æ•°ä¸­è®¾ç½®ä¸€ä¸‹æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æºç public interface IExcelDictHandler { //è·å–å­—å…¸æ‰€æœ‰å€¼ï¼Œå¸¦å…¥ä¸‹æ‹‰ default List&amp;lt;Map&amp;gt; getList(String dict) { return null; } //å€¼-&amp;gt;åç§° String toName(String var1, Object var2, String var3, Object var4); //åç§°-&amp;gt;å€¼ String toValue(String var1, Object var2, String var3, Object var4);}ä¾‹å¦‚æˆ‘ä»¬è‡ªå·±å®ç°çš„æ¥å£ @Override public String toName(String dict, Object obj, String name, Object value) { if (&quot;applyStatus&quot;.equals(dict)) { if (Integer.parseInt(String.valueOf(value))==0) { return &quot;ç”³è¯·ä¸­&quot;; }else if (Integer.parseInt(String.valueOf(value))==1) { return &quot;å®¡æ ¸é€šè¿‡&quot;; }else if (Integer.parseInt(String.valueOf(value))==2) { return &quot;ä¸é€šè¿‡&quot;; } } return &quot;-&quot;; }ç„¶åè®¾ç½®TemplateExportParams params = new TemplateExportParams( &quot;test.xlsx&quot;); params.setDictHandler(new IExcelDictHandlerImpl());å³å¯å®Œæˆå€¼åˆ°åç§°çš„å­—å…¸è½¬æ¢ï¼Œä¹Ÿå¯ä»¥è·å–ç³»ç»Ÿå­—å…¸å€¼è¿›è¡ŒæŸ¥è¯¢è½¬æ¢" }, { "title": "2022å°å°çš„æ€»ç»“", "url": "/posts/2022%E5%B0%8F%E5%B0%8F%E7%9A%84%E6%80%BB%E7%BB%93/", "categories": "", "tags": "", "date": "2022-09-16 16:32:00 +0800", "snippet": "æœ‰ä¸¤å¹´æ²¡å†™ç¬”è®°äº†ä¸Šæ¬¡è¿˜æ˜¯2020å¹´8æœˆï¼Œå»å¹´åœ¨å¹²å˜›å‘¢ï¼Œå›æƒ³èµ·æ¥ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§äº‹ï¼Œæ€€å­•å·¥ä½œï¼Œæ³¢æ¾œä¸æƒŠï¼Œå¤§ç–«ä¸‰å¹´ï¼Œåšä»€ä¹ˆéƒ½æ²¡æœ‰åŠ¨åŠ›ã€‚æœ€è¿‘ç«äº†ä¸€ä¸ªç¾Šäº†ä¸ªç¾Šï¼Œå¹¿å‘Šä¸»æ”¶ç›Šæ‹¿åˆ°è½¯ï¼Œå›½æ°‘çˆ†æ¬¾ï¼Œä¸Šæ¬¡è¿™ä¹ˆç«çš„æ¸¸æˆè¿˜æ˜¯å®‰å“åˆæœŸå¹´ä»£çš„flip birdsï¼Œå¹¿å‘Šæ”¶ç›Šä¹Ÿæ˜¯çˆ†äº†ï¼Œåˆ›ä¸šæ–¹å‘ä¹Ÿåœ¨ä¸æ–­å°è¯•ï¼ŒèŠ±æ¼¾å­—ä½“å°ç¨‹åºä¹Ÿæœ‰äº†äº›è®¸å¾®å¼±æå°çš„æ”¶ç›Šï¼Œå®¶æ”¿äº’è”ç½‘æ¸ é“å–å¾—äº†ä¸é”™çš„æˆç»©ï¼Œæ¯å¤©éƒ½æœ‰æˆå•ã€‚ä½†æ˜¯ä»ç„¶æ²¡æœ‰ä¸€ä¸ªç¨³å®šçš„æ”¶ç›Šæ¸ é“ï¼Œç›®å‰æœ‰ä¸¤æ¡è·¯åœ¨çœ¼å‰ï¼Œç ”ç©¶AIï¼Œnlpã€cvã€biéƒ½æœ‰ä¸é”™çš„å‰æ™¯ï¼ŒæŠ‘æˆ–ç»§ç»­åç«¯å‰ç«¯å°ç¨‹åºï¼Œåè€…èµ›é“ä¸Šæƒ³è¦çªå‡ºä¸æ˜¯å¾ˆå®¹æ˜“ï¼ŒAIæ–¹å‘æ›´å¤šèƒ½åšä¸€äº›æ”¹é€ ä¸€äº›çªç ´ä¸€äº›æŒ‘æˆ˜ã€‚ä»Šå¹´7æœˆå®å®å‡ºç”Ÿï¼Œ30ä¸æƒ‘ï¼Œé“è·¯ä¼¼ä¹æ¸…æ˜ä½†æ˜¯ä¾æ—§æœ‰äº›è®¸ç–‘æƒ‘ï¼ŒåŠ æ²¹ï¼" }, { "title": "dockerå®‰è£…jenkinså¹¶éƒ¨ç½²æœåŠ¡", "url": "/posts/docker%E5%AE%89%E8%A3%85jenkins%E5%B9%B6%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/", "categories": "", "tags": "docker, jenkins", "date": "2022-06-14 08:29:49 +0800", "snippet": "å®‰è£…1ã€æ–°å»ºæ–‡ä»¶å¤¹jenkinsï¼Œæ–°å»ºdocker-compose.ymlæ–‡ä»¶ï¼Œé»˜è®¤å·²å®‰è£…docker-composeï¼Œæ‹·è´å¦‚ä¸‹é…ç½®ã€‚version: &#39;3.1&#39;services: jenkins: image: jenkins/jenkins:lts restart: always hostname: jenkins container_name: jenkins privileged: true # ç‰¹æƒæ¨¡å¼ user: root ports: - 7777:8080 #webç«¯å£æ˜ å°„ - 50000:50000 environment: TZ: Asia/Shanghai JENKINS_JAVA_OPTIONS: -Djava.awt.headless=true -Xms512m -Xmx1024m -XX:MaxNewSize=512m -XX:MaxPermSize=512m #é™åˆ¶å†…å­˜å¤§å°ï¼Œå°å†…å­˜å“­äº† volumes: - /root/env/Jenkins/data:/var/jenkins_home # jenkinsæ•°æ®ç›®å½• - /root/env/apache-maven-3.5.4:/usr/local/maven # mavenæ˜ å°„2ã€å¯åŠ¨jenkins æ‰§è¡Œdokcer-compose up -d å¦‚æœä¿®æ”¹è¿‡é…ç½®æ–‡ä»¶ï¼Œé‡æ–°æ‰§è¡Œæ­¤å‘½ä»¤ä¼šé‡å»ºå®¹å™¨ï¼Œé™¤äº†æŒ‚è½½å·ï¼Œä¿®æ”¹å†…å®¹éƒ½ä¼šæ¶ˆå¤±ã€‚3ã€è®¿é—®ä¸Šé¢æ˜ å°„çš„ç«¯å£ localhost:7777,å¯†ç å¯ä»¥æŸ¥çœ‹docker logs -f jenkinsã€‚é…ç½®1ã€å®‰è£…æ’ä»¶giteeã€Publish Over SSHï¼Œé…ç½®mavenåœ°å€ã€giteeè´¦å·ã€‚ æ­¤å¤„æ³¨æ„mavenæ–‡ä»¶éœ€è¦é…ç½®æˆå¦‚ä¸‹ï¼Œåœ¨mavenæ ¹ç›®å½•æ–°å»ºckæ–‡ä»¶å¤¹ï¼ŒåŒæ—¶ä¿®æ”¹åŒ…ä¸‹è½½è·¯å¾„ï¼Œè¿™æ ·åŒ…ä¼šä¸‹è½½åˆ°æ˜ å°„çš„å®¿ä¸»æœºæ–‡ä»¶å¤¹ä¸­ï¼Œä¾¿äºåæœŸç®¡ç† &amp;lt;localRepository&amp;gt;${maven.home}/ck&amp;lt;/localRepository&amp;gt; 2ã€é…ç½®sshè®¿é—®ï¼ŒAè¦è®¿é—®Bä¸»æœº(æœ¬æ¡ˆAä¸ºdocker jenkinsï¼ŒBä¸ºå®¿ä¸»æœº)ï¼Œéœ€è¦Aç”Ÿæˆsshå‡­è¯ï¼Œå¹¶æŠŠå…¬é’¥ä¼ ç»™Bï¼Œç”±äºjenkinsç‰ˆæœ¬åŸå› ï¼Œç”Ÿæˆsshå‡­è¯ä»£ç ä¸º ssh-keygen -m PEM -t rsa -b 4096,å†é€šè¿‡ssh-copy-id 192.168.66.103æŠŠå…¬é’¥ä¼ è¾“åˆ°Bã€‚åœ¨é…ç½®é¡µé¢è¿›è¡Œé…ç½®åï¼Œç‚¹å‡»Test Configurationåæ˜¾ç¤ºsuccesså³å®ŒæˆPublish Over SSHé…ç½®ã€‚éƒ¨ç½²è¿™é‡Œé€‰ç”¨æ˜¯è‡ªç”±é£æ ¼é¡¹ç›®ï¼Œæ‹‰å–æºä»£ç åè¿›è¡Œmavenç¼–è¯‘ï¼Œç¼–è¯‘å®Œæˆåè¿›è¡Œæ¨é€jaråŒ…åˆ°è¿œç¨‹ä¸»æœºï¼Œæœ¬æ¡ˆä¸ºå®¿ä¸»æœºã€‚ç„¶åæ‰§è¡Œé¡¹ç›®ä¸‹éƒ¨ç½²è„šæœ¬ï¼Œéœ€è¦æ³¨æ„æ€è¿›ç¨‹å¯èƒ½æŠŠjenkinséƒ¨ç½²è¿›ç¨‹æ€æ‰ï¼Œéœ€è¦åœ¨è„šæœ¬ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®export BUILD_ID=dontKillMesource /etc/profile#!/bin/bash#jaråŒ…æ–‡ä»¶å¤¹è·¯å¾„åŠåç§°APP_NAME=/root/java/haoayi/jbhay.jar#æ—¥å¿—æ–‡ä»¶è·¯å¾„åŠåç§°LOG_FILE=log/application_log.log#é‡å¯å‘½ä»¤pid=`ps -ef | grep $APP_NAME | grep -v grep |awk &#39;{print $2}&#39;`if [ $pid ]thenkill -9 $pidfi# å¯åŠ¨jaråŒ…ï¼ŒæŒ‡å‘æ—¥å¿—æ–‡ä»¶ï¼Œ2&amp;gt;&amp;amp;1 &amp;amp; è¡¨ç¤ºæ‰“å¼€æˆ–æŒ‡å‘åŒä¸€ä¸ªæ—¥å¿—æ–‡ä»¶export BUILD_ID=dontKillMesource /etc/profilenohup java -jar $APP_NAME --spring.profiles.active=pro &amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &amp;amp;" }, { "title": "è®°ä¸€æ¬¡ç”Ÿäº§ç¯å¢ƒfastdfsæŠ¥é”™", "url": "/posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83fastdfs%E6%8A%A5%E9%94%99/", "categories": "", "tags": "è¿ç»´, linux", "date": "2022-05-30 11:23:53 +0800", "snippet": "èµ·å› è¿è¥åœ¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™æŠ¥é”™æç¤ºå¦‚ä¸‹: é”™è¯¯ç  28 é”™è¯¯ä¿¡æ¯ æ²¡æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´,ç»æŸ¥è¯¢æ˜¯fastdfs trackerä¸­è®¾ç½®äº†æœåŠ¡å™¨å®¹é‡é™åˆ¶ï¼Œå½“æœåŠ¡å™¨å‰©ä½™å®¹é‡å°äºé…ç½®é¡¹çš„æƒ…å†µä¸‹ï¼ˆé»˜è®¤10%ï¼‰ï¼Œä¼šæŠ¥å¦‚ä¸Šé”™è¯¯ã€‚æ–°åˆ†é…çš„ç³»ç»Ÿ300gï¼Œä¸å¯èƒ½ä¼ æ»¡å§ï¼Œç„¶åæŸ¥äº†ä¸€ä¸‹æœ‰ä¸€å—250gçš„ç¡¬ç›˜æ²¡æœ‰æŒ‚è½½ï¼Œç³»ç»Ÿç›˜44gå®¹é‡å·²ç»æ‰€å‰©æ— å‡ ã€‚è§£å†³æ–¹æ¡ˆ æ²»æ ‡ä¸æ²»æœ¬çš„æ–¹æ³•ï¼Œè°ƒå°é…ç½®é¡¹åˆ°5%ï¼Œä½†æ˜¯æœ€åè‚¯å®šä¼šæ»¡ã€‚ æ‰©å®¹æœåŠ¡å™¨ï¼Œç»è¿‡è¿ç»´æŒ‡å¯¼ï¼ŒæˆåŠŸæ‰©å¤§å®¹é‡ï¼Œæ“ä½œå¦‚ä¸‹ã€‚#æŸ¥çœ‹ç¡¬ç›˜df -h#æŠŠæ–°ç›˜åšæˆpvpvcreate /dev/sdb#åŠ åˆ°centosçš„vgé‡Œé¢vgextend centos /dev/sdb#æ‰©å®¹åˆ°æŒ‡å®šç›˜lvextend -L +100G /dev/mapper/centos-root#é€»è¾‘æ‰©å®¹xfs_growfs /dev/mapper/centos-rootvgså°±å¯ä»¥çœ‹åˆ°ä½ vgé‡Œé¢è¿˜å‰©å¤šå°‘å¯ä»¥åŠ çš„" }, { "title": "kkFileViewå®ç°æ–‡ä»¶ä¼˜é›…é¢„è§ˆæ°´å°", "url": "/posts/kkFileView%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%BC%98%E9%9B%85%E9%A2%84%E8%A7%88%E6%B0%B4%E5%8D%B0/", "categories": "", "tags": "å¼€æºé¡¹ç›®", "date": "2022-04-27 09:22:31 +0800", "snippet": "èµ·å› é¡¹ç›®ä¸­åŒ…å«å¤§é‡officeæ–‡ä»¶ä»¥åŠpdféœ€è¦å®ç°åœ¨çº¿é¢„è§ˆï¼Œå‰ç«¯é¢„è§ˆåªèƒ½å®ç°pdfé¢„è§ˆä¸”æ•ˆæœä¸ä½³é¡¹ç›®ä»‹ç»springbootæ­å»ºçš„æ–‡ä»¶é¢„è§ˆæœåŠ¡ï¼Œéœ€è¦ä½œä¸ºç¬¬ä¸‰æ–¹æœåŠ¡å™¨å¯åŠ¨ï¼ŒåŸç†æ˜¯å°†æ–‡ä»¶é€šè¿‡æœ¬åœ°å®‰è£…çš„openofficeæˆ–è€…libreofficeè½¬æ¢æˆpdfï¼Œè¿›è€Œå¯ä»¥è½¬æ¢æˆå›¾ç‰‡ï¼Œè¾“å‡ºåˆ°å‰ç«¯æ¨¡æ¿ä¸­ã€‚ä¸”å¯ä»¥æ·»åŠ è‡ªå®šä¹‰æ°´å°ï¼Œé…ç½®æ–‡ä»¶ä¸­ä¹Ÿæœ‰å¤šç§é€‰é¡¹å¯ä»¥é…ç½®#######################################ä¸å¯åŠ¨æ€é…ç½®ï¼Œéœ€è¦é‡å¯ç”Ÿæ•ˆ#######################################server.port = ${KK_SERVER_PORT:8012}server.servlet.context-path= ${KK_CONTEXT_PATH:/}server.servlet.encoding.charset = utf-8#æ–‡ä»¶ä¸Šä¼ é™åˆ¶spring.servlet.multipart.max-file-size=500MBspring.servlet.multipart.max-request-size=500MB## Freemarker é…ç½®spring.freemarker.template-loader-path = classpath:/web/spring.freemarker.cache = falsespring.freemarker.charset = UTF-8spring.freemarker.check-template-location = truespring.freemarker.content-type = text/htmlspring.freemarker.expose-request-attributes = truespring.freemarker.expose-session-attributes = truespring.freemarker.request-context-attribute = requestspring.freemarker.suffix = .ftl# office-plugin## officeè½¬æ¢æœåŠ¡çš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤å¼€å¯ä¸¤ä¸ªè¿›ç¨‹office.plugin.server.ports = 2001,2002## office è½¬æ¢æœåŠ¡ task è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤äº”åˆ†é’Ÿoffice.plugin.task.timeout = 5m#é¢„è§ˆç”Ÿæˆèµ„æºè·¯å¾„ï¼ˆé»˜è®¤ä¸ºæ‰“åŒ…æ ¹è·¯å¾„ä¸‹çš„fileç›®å½•ä¸‹ï¼‰#file.dir = D:\\\\kkFileview\\\\file.dir = ${KK_FILE_DIR:default}#å…è®¸é¢„è§ˆçš„æœ¬åœ°æ–‡ä»¶å¤¹ é»˜è®¤ä¸å…è®¸ä»»ä½•æœ¬åœ°æ–‡ä»¶è¢«é¢„è§ˆ#file.dir = D:\\\\kkFileview\\\\local.preview.dir = ${KK_LOCAL_PREVIEW_DIR:default}#openoffice homeè·¯å¾„#office.home = C:\\\\Program Files (x86)\\\\OpenOffice 4office.home = ${KK_OFFICE_HOME:default}#ç¼“å­˜å®ç°ç±»å‹ï¼Œä¸é…é»˜è®¤ä¸ºå†…åµŒRocksDB(type = default)å®ç°ï¼Œå¯é…ç½®ä¸ºredis(type = redis)å®ç°ï¼ˆéœ€è¦é…ç½®spring.redisson.addressç­‰å‚æ•°ï¼‰å’Œ JDK å†…ç½®å¯¹è±¡å®ç°ï¼ˆtype = jdkï¼‰,cache.type = ${KK_CACHE_TYPE:jdk}#redisè¿æ¥ï¼Œåªæœ‰å½“cache.type = redisæ—¶æ‰æœ‰ç”¨spring.redisson.address = ${KK_SPRING_REDISSON_ADDRESS:127.0.0.1:6379}spring.redisson.password = ${KK_SPRING_REDISSON_PASSWORD:}#ç¼“å­˜æ˜¯å¦è‡ªåŠ¨æ¸…ç† true ä¸ºå¼€å¯ï¼Œæ³¨é‡Šæ‰æˆ–å…¶ä»–å€¼éƒ½ä¸ºå…³é—­cache.clean.enabled = ${KK_CACHE_CLEAN_ENABLED:true}#ç¼“å­˜è‡ªåŠ¨æ¸…ç†æ—¶é—´ï¼Œcache.clean.enabled = trueæ—¶æ‰æœ‰ç”¨ï¼Œcronè¡¨è¾¾å¼ï¼ŒåŸºäºQuartz croncache.clean.cron = ${KK_CACHE_CLEAN_CRON:0 0 3 * * ?}#######################################å¯åœ¨è¿è¡Œæ—¶åŠ¨æ€é…ç½®########################################æä¾›é¢„è§ˆæœåŠ¡çš„åœ°å€ï¼Œé»˜è®¤ä»è¯·æ±‚urlè¯»ï¼Œå¦‚æœä½¿ç”¨nginxç­‰åå‘ä»£ç†ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®#base.url = https://file.keking.cnbase.url = ${KK_BASE_URL:default}#ä¿¡ä»»ç«™ç‚¹ï¼Œå¤šä¸ªç”¨&#39;,&#39;éš”å¼€ï¼Œè®¾ç½®äº†ä¹‹åï¼Œä¼šé™åˆ¶åªèƒ½é¢„è§ˆæ¥è‡ªä¿¡ä»»ç«™ç‚¹åˆ—è¡¨çš„æ–‡ä»¶ï¼Œé»˜è®¤ä¸é™åˆ¶#trust.host = file.keking.cn,kkfileview.keking.cntrust.host = ${KK_TRUST_HOST:default}#æ˜¯å¦å¯ç”¨ç¼“å­˜cache.enabled = ${KK_CACHE_ENABLED:true}#æ–‡æœ¬ç±»å‹ï¼Œé»˜è®¤å¦‚ä¸‹ï¼Œå¯è‡ªå®šä¹‰æ·»åŠ simText = ${KK_SIMTEXT:txt,html,htm,asp,jsp,xml,json,properties,md,gitignore,log,java,py,c,cpp,sql,sh,bat,m,bas,prg,cmd}#å¤šåª’ä½“ç±»å‹ï¼Œé»˜è®¤å¦‚ä¸‹ï¼Œå¯è‡ªå®šä¹‰æ·»åŠ media = ${KK_MEDIA:mp3,wav,mp4,flv}#æ˜¯å¦å¼€å¯å¤šåª’ä½“ç±»å‹è½¬è§†é¢‘æ ¼å¼è½¬æ¢,ç›®å‰å¯è½¬æ¢è§†é¢‘æ ¼å¼æœ‰ï¼šavi,mov,wmv,3gp,rm#è¯·è°¨æ…å¼€å¯æ­¤åŠŸèƒ½ï¼Œå»ºè®®å¼‚æ­¥è°ƒç”¨æ·»åŠ åˆ°å¤„ç†é˜Ÿåˆ—ï¼Œå¹¶ä¸”å¢åŠ ä»»åŠ¡é˜Ÿåˆ—å¤„ç†çº¿ç¨‹ï¼Œé˜²æ­¢è§†é¢‘è½¬æ¢å ç”¨å®Œçº¿ç¨‹èµ„æºï¼Œè½¬æ¢æ¯”è¾ƒè€—è´¹æ—¶é—´,å¹¶ä¸”æ§åˆ¶äº†åªèƒ½ä¸²è¡Œå¤„ç†è½¬æ¢ä»»åŠ¡media.convert.disable = ${KK_MEDIA_CONVERT_DISABLE:false}#æ”¯æŒè½¬æ¢çš„è§†é¢‘ç±»å‹convertMedias = ${KK_CONVERTMEDIAS:avi,mov,wmv,mkv,3gp,rm} #officeç±»å‹æ–‡æ¡£(word ppt)æ ·å¼ï¼Œé»˜è®¤ä¸ºå›¾ç‰‡(image)ï¼Œå¯é…ç½®ä¸ºpdfï¼ˆé¢„è§ˆæ—¶ä¹Ÿæœ‰æŒ‰é’®åˆ‡æ¢ï¼‰office.preview.type = ${KK_OFFICE_PREVIEW_TYPE:image}#æ˜¯å¦å…³é—­officeé¢„è§ˆåˆ‡æ¢å¼€å…³ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¯é…ç½®ä¸ºtrueå…³é—­office.preview.switch.disabled = ${KK_OFFICE_PREVIEW_SWITCH_DISABLED:false}#æ˜¯å¦ç¦æ­¢ä¸‹è½½è½¬æ¢ç”Ÿæˆçš„pdfæ–‡ä»¶pdf.download.disable = ${KK_PDF_DOWNLOAD_DISABLE:false}#æ˜¯å¦ç¦ç”¨é¦–é¡µæ–‡ä»¶ä¸Šä¼ file.upload.disable = ${KK_FILE_UPLOAD_ENABLED:false}#é¢„è§ˆæºä¸ºFTPæ—¶ FTPç”¨æˆ·åï¼Œå¯åœ¨ftp urlåé¢åŠ å‚æ•°ftp.username=ftpuseræŒ‡å®šï¼ŒÃ¤Â¸æŒ‡å®šé»˜è®¤ç”¨é…ç½®çš„ftp.username = ${KK_FTP_USERNAME:ftpuser}#é¢„è§ˆæºä¸ºFTPæ—¶ FTPå¯†ç ï¼Œå¯åœ¨ftp urlåé¢åŠ å‚æ•°ftp.password=123456æŒ‡å®šï¼Œä¸æŒ‡å®šé»˜è®¤ç”¨é…ç½®çš„ftp.password = ${KK_FTP_PASSWORD:123456}#é¢„è§ˆæºä¸ºFTPæ—¶, FTPè¿æ¥é»˜è®¤ControlEncoding(æ ¹æ®FTPæœåŠ¡å™¨æ“ä½œç³»ç»Ÿé€‰æ‹©ï¼ŒLinuxä¸€èˆ¬ä¸ºUTF-8ï¼ŒWindowsä¸€èˆ¬ä¸ºGBK)ï¼Œå¯åœ¨ftp urlåé¢åŠ å‚æ•°ftp.control.encoding=UTF-8æŒ‡å®šï¼Œä¸æŒ‡å®šé»˜è®¤ç”¨é…ç½®çš„ftp.control.encoding = ${KK_FTP_CONTROL_ENCODING:UTF-8}#æ°´å°å†…å®¹#ä¾‹ï¼šwatermark.txt = ${WATERMARK_TXT:å‡¯äº¬ç§‘æŠ€å†…éƒ¨æ–‡ä»¶ï¼Œä¸¥ç¦å¤–æ³„}#å¦‚éœ€å–æ¶ˆæ°´å°ï¼Œå†…å®¹è®¾ç½®ä¸ºç©ºå³å¯ï¼Œä¾‹ï¼šwatermark.txt = ${WATERMARK_TXT:}watermark.txt = ${WATERMARK_TXT:}#æ°´å°xè½´é—´éš”watermark.x.space = ${WATERMARK_X_SPACE:10}#æ°´å°yè½´é—´éš”watermark.y.space = ${WATERMARK_Y_SPACE:10}#æ°´å°å­—ä½“watermark.font = ${WATERMARK_FONT:å¾®è½¯é›…é»‘}#æ°´å°å­—ä½“å¤§å°watermark.fontsize = ${WATERMARK_FONTSIZE:18px}#æ°´å°å­—ä½“é¢œè‰²watermark.color = ${WATERMARK_COLOR:black}#æ°´å°é€æ˜åº¦ï¼Œè¦æ±‚è®¾ç½®åœ¨å¤§äºç­‰äº0.005ï¼Œå°äº1watermark.alpha = ${WATERMARK_ALPHA:0.2}#æ°´å°å®½åº¦watermark.width = ${WATERMARK_WIDTH:180}#æ°´å°é«˜åº¦watermark.height = ${WATERMARK_HEIGHT:80}#æ°´å°å€¾æ–œåº¦æ•°ï¼Œè¦æ±‚è®¾ç½®åœ¨å¤§äºç­‰äº0ï¼Œå°äº90watermark.angle = ${WATERMARK_ANGLE:10}é¡¹ç›®æ•´åˆ ç³»ç»Ÿå†…ä¸‹è½½é‡‡ç”¨çš„æ˜¯http/httpsä¸‹è½½æµurlé¢„è§ˆå¾ˆå¤šç³»ç»Ÿå†…ä¸æ˜¯ç›´æ¥æš´éœ²æ–‡ä»¶ä¸‹è½½åœ°å€ï¼Œè€Œæ˜¯è¯·æ±‚é€šè¿‡idã€codeç­‰å‚æ•°åˆ°é€šè¿‡ç»Ÿä¸€çš„æ¥å£ï¼Œåç«¯é€šè¿‡idæˆ–codeç­‰å‚æ•°å®šä½æ–‡ä»¶ï¼Œå†é€šè¿‡OutputStreamè¾“å‡ºä¸‹è½½ï¼Œæ­¤æ—¶ä¸‹è½½urlæ˜¯ä¸å¸¦æ–‡ä»¶åç¼€åçš„ï¼Œé¢„è§ˆæ—¶éœ€è¦æ‹¿åˆ°æ–‡ä»¶åï¼Œä¼ ä¸€ä¸ªå‚æ•°fullfilename=xxx.xxxæ¥æŒ‡å®šæ–‡ä»¶åï¼Œç¤ºä¾‹å¦‚ä¸‹ var originUrl = &#39;http://127.0.0.1:8080/filedownload?fileId=1&#39;; //è¦é¢„è§ˆæ–‡ä»¶çš„è®¿é—®åœ°å€var previewUrl = originUrl + &#39;&amp;amp;fullfilename=test.txt&#39;window.open(&#39;http://127.0.0.1:8012/onlinePreview?url=&#39;+encodeURIComponent(Base64.encode(previewUrl))); é¡¹ç›®è¿˜æ”¯æŒè‡ªå®šä¹‰ä¼ å…¥æ°´å°ï¼Œåœ¨é¢„è§ˆurlåé¢åŠ ä¸Šå‚æ•°&amp;amp;watermarkTxtå³å¯ var url = &#39;http://127.0.0.1:8080/file/test.txt&#39;; //è¦é¢„è§ˆæ–‡ä»¶çš„è®¿é—®åœ°å€window.open(&#39;http://127.0.0.1:8012/onlinePreview?url=&#39; + encodeURIComponent(url) + &#39;&amp;amp;watermarkTxt=&#39; + encodeURIComponent(&#39;åŠ¨æ€æ°´å°&#39;)); ç”±äºéœ€è¦è‡ªå®šä¹‰ä¼ å…¥æ°´å°ï¼Œæ‰€ä»¥å¯¹åŸæ¥çš„æ°´å°å¤„ç†åšäº†ä¿®æ”¹,ä»£ç æ‹¦æˆªå™¨ä½äºAttributeSetFilter,å…¶ä¸­æ‹¦æˆªäº†watermarkTxtå‚æ•°ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°å½“å‰è¯·æ±‚requestå¯¹è±¡ä¸­ã€‚æˆ‘ä»¬ä¿®æ”¹äº†å‚æ•°å€¼å¹¶ä¸”å¯¹é½è¿›è¡Œbase64è½¬ç æ“ä½œï¼Œå½“ç„¶é˜²å›å­ä¸é˜²å°äººï¼Œå‚æ•°æ”¾åœ¨urlè¯·æ±‚ä¸­æœ¬æ¥å°±æ˜¯ä¸å®‰å…¨çš„ï¼Œåªæ˜¯åšäº†äº›è®¸è½¬ç èƒ½é™ä½åˆ«äººå»é™¤æ°´å°çš„éš¾åº¦ã€‚String watermarkTxt = new String(Base64.decodeBase64(request.getParameter(&quot;wmc&quot;)), StandardCharsets.UTF_8);request.setAttribute(&quot;watermarkTxt&quot;, watermarkTxt != null ? watermarkTxt : WatermarkConfigConstants.getWatermarkTxt());é¡¹ç›®æ‰“åŒ…å¯åŠ¨1.dockerå®‰è£…//mavenç¼–è¯‘ï¼Œmvn clean package -DskipTests//è¿›è¡Œæ‰“åŒ…æ“ä½œ ç„¶åç”Ÿæˆimagedocker build -t keking/kkfileview:v4.0.0 .//dockerå¯åŠ¨ å¹¶ä¸”å¯ä»¥ä¼ å…¥é…ç½®æ–‡ä»¶ä¸­å¯¹åº”å˜é‡docker run --restart=always -d \\ -e KK_BASE_URL=&quot;https://é¢„è§ˆåœ°å€/kkfile&quot; \\ -e KK_CONTEXT_PATH=&quot;/kkfile&quot; \\ -it -p 8012:8012 --name kkfile keking/kkfileview:v4.0.0 //KK_BASE_URLä½œä¸ºç½‘ç«™é¢„è§ˆåŸŸåï¼Œ //KK_CONTEXT_PATH å¯¹åº”nginxä¸­é…ç½®çš„locationåœ°å€ï¼Œå¦‚ä½œä¸ºå•ç‹¬ç«¯å£æ˜ å°„æ— äºŒçº§åŸŸååˆ™å¯ä»¥ä¸å¡« server { listen 20303; server_name localhost; location /kkfile { proxy_pass http://localhost:8012; }}dockeræ‹“å±•ï¼šæ¯æ¬¡æ‰“åŒ…æ—¶é—´è¾ƒé•¿ï¼Œå¯ä»¥é‡‡ç”¨æ˜ å°„æ–‡ä»¶å¤¹ï¼Œæ›¿æ¢jaråŒ…æ–¹å¼æ¥è¿›è¡Œæ›´æ–°ã€‚é€šè¿‡æŸ¥çœ‹Dockerfileå¯ä»¥ç¡®å®šå®¹å™¨å†…/opt/kkFileView-4.1.0-SNAPSHOT,å­˜æ”¾jaråŒ…å’Œé…ç½®æ–‡ä»¶ã€‚ENTRYPOINT [&quot;java&quot;,&quot;-Dfile.encoding=UTF-8&quot;,&quot;-Dspring.config.location=/opt/kkFileView-4.1.0-SNAPSHOT/config/application.properties&quot;,&quot;-jar&quot;,&quot;/opt/kkFileView-4.1.0-SNAPSHOT/bin/kkFileView-4.1.0-SNAPSHOT.jar&quot;]åœ¨å®¿ä¸»æœºå†…æ–°å»ºæ–‡ä»¶å¤¹å¹¶åœ¨å†…éƒ¨åˆ›å»ºbinå’Œconfigæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™è¿›è¡Œæ˜ å°„ï¼Œä¹‹åæ¯æ¬¡ç¼–è¯‘åå°†jaråŒ…æ”¾å…¥binï¼Œé…ç½®æ–‡ä»¶æ”¾å…¥configå³å¯ï¼Œå¯éšæ—¶æ–¹ä¾¿çš„ä¿®æ”¹é…ç½®æ–‡ä»¶äº†ï¼ŒåŒæ—¶ä¸‹è½½å’Œè½¬æ¢åçš„æ–‡ä»¶å­˜åœ¨äºåŒç›®å½•çš„fileæ–‡ä»¶å¤¹ä¸‹ã€‚docker run --restart=always -d \\ -e KK_BASE_URL=&quot;https://é¢„è§ˆåœ°å€/kkfile&quot; \\ -e KK_CONTEXT_PATH=&quot;/kkfile&quot; \\ -v å®¿ä¸»æœºæ–‡ä»¶å¤¹:/opt/kkFileView-4.1.0-SNAPSHOT \\ -it -p 8012:8012 --name kkfile keking/kkfileview:v4.0.02.æºç ç¼–è¯‘ä¸Šä¼ ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè¿è¡Œbinä¸­çš„start.shå¯åŠ¨ï¼Œä¼šè‡ªåŠ¨å®‰è£…libreofficeä»¥åŠå¯åŠ¨é¡¹ç›®ã€‚ï¼ˆç›®å‰è¿˜æœªå°è¯•ï¼‰æ•ˆæœå±•ç¤ºåç»­é—®é¢˜ è™½ç„¶ç¦ç”¨ä¸‹è½½æŒ‰é’®äº†ï¼Œä½†æ˜¯é¡µé¢å¯ä»¥ctrl+sä¸‹è½½é—®é¢˜ï¼Œå®šä½åˆ°æ˜¯pdf.jsçš„é—®é¢˜ï¼Œä¿®æ”¹view.jsæºç ,æ³¨é‡Šæ‰å¯¹åº”ä»£ç ã€‚ if (cmd === 1 || cmd === 8) { switch (evt.keyCode) { case 83: // eventBus.dispatch(&quot;download&quot;, { // source: window // }); // handled = true; break; ctrl+pæ‰“å°ä¾ç„¶å¯ä»¥ä¿å­˜æ–‡ä»¶,ä¿®æ”¹view.jsæºç ,æ³¨é‡Šæ‰å¯¹åº”ä»£ç ã€‚ window.addEventListener(&quot;keydown&quot;, function (event) { if (event.keyCode === 80 &amp;amp;&amp;amp; (event.ctrlKey || event.metaKey) &amp;amp;&amp;amp; !event.altKey &amp;amp;&amp;amp; (!event.shiftKey || window.chrome || window.opera)) { // window.print(); event.preventDefault(); if (event.stopImmediatePropagation) { event.stopImmediatePropagation(); } else { event.stopPropagation(); } }}, true); " }, { "title": "ã€æºç åˆ†æã€‘springsecurity oauth2è®¤è¯æµç¨‹", "url": "/posts/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-oauth2%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B/", "categories": "", "tags": "springsecurity, oauth2", "date": "2022-04-22 14:27:27 +0800", "snippet": "ç™»å½•è¯·æ±‚é¡¹ç›®æ•´åˆSpringSecurityåï¼Œæ‰€æœ‰httpè¯·æ±‚ç”±å…¶æ‰˜ç®¡ã€‚å½“ç”¨æˆ·å‘èµ·/oauth/tokenè¯·æ±‚ï¼Œå…¶åˆå§‹åŒ–çš„è´£ä»»é“¾åŒ…å«ä¸€ç³»åˆ—çš„æ‹¦æˆªå™¨ä¼šå…ˆå¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼ŒéªŒè¯pathåˆæ³•æ€§ä»¥åŠè·å–clientIdç­‰æ“ä½œï¼Œå®Œæˆä¹‹åè¿›å…¥ TokenEndpointçš„postAccessTokenæ–¹æ³•,å†ç»è¿‡ä¸€ç³»åˆ—åŸŸè®¤è¯ï¼Œç„¶åè¿›å…¥ç”Ÿæˆtokençš„æ“ä½œã€‚ç”Ÿæˆtokenç”Ÿæˆtokenä¹‹å‰æ ¹æ®ç”¨æˆ·åè°ƒç”¨ç”¨æˆ·æœåŠ¡æ¥å£æ¥è·å–ä¿¡æ¯ï¼Œå¯¹ç”¨æˆ·åå¯†ç è¿›è¡Œæ ¡éªŒï¼Œå…·ä½“æµç¨‹è§ä¹‹å‰çš„æ–‡ç« ï¼Œé€šè¿‡ä¹‹åå°±ç”Ÿæˆtokenï¼Œå­˜å…¥é»˜è®¤æˆ–è€…è‡ªå®šçš„tokenstore" }, { "title": "ã€æºç åˆ†æã€‘springmvcçš„æ¶ˆæ¯è½¬æ¢å™¨", "url": "/posts/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-springmvc%E7%9A%84%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8/", "categories": "", "tags": "java, SpringMVC", "date": "2022-04-20 09:40:19 +0800", "snippet": "ç–‘é—®ä¸ºä»€ä¹ˆspringbootçš„Controllerå¸¦ä¸Š@RestControlleræ³¨è§£å°±å¯ä»¥ç›´æ¥è¿”å›jsonå‘¢@Target({ElementType.TYPE})@Retention(RetentionPolicy.RUNTIME)@Documented@Controller@ResponseBodypublic @interface RestController { @AliasFor( annotation = Controller.class ) String value() default &quot;&quot;;}å¯ä»¥çœ‹åˆ°æºç é‡Œå¸¦ä¸Šäº†@ResonseBodyæ³¨è§£ï¼Œè¿™å°±ç›¸å½“äºç»™Controlleré‡Œé¢æ¯ä¸ªæ–¹æ³•å¢åŠ äº†è¿™ä¸ªæ³¨è§£ï¼Œè¯¥æ³¨è§£ç”¨äºå°†Controllerçš„æ–¹æ³•è¿”å›çš„å¯¹è±¡ï¼Œé€šè¿‡é€‚å½“çš„HttpMessageConverterè½¬æ¢ä¸ºæŒ‡å®šæ ¼å¼åï¼Œå†™å…¥åˆ°Responseå¯¹è±¡çš„bodyæ•°æ®åŒºã€‚æ¶ˆæ¯è½¬æ¢å™¨ HttpMessageConverterMVCä¼šæ·»åŠ å‡ ä¸ªé»˜è®¤çš„è½¬æ¢å™¨ï¼ŒHttpMessageConvertersç»´æŠ¤äº†ä¸€ä¸ªHttpMessageConverteré›†åˆã€‚WebMvcConfigurationSupportç±»çš„æ–¹æ³•addDefaultHttpMessageConvertersä¸­å¯ä»¥çœ‹åˆ°ã€‚è€Œè¦åŠ¨ç”¨è¿™äº›æ¶ˆæ¯è½¬æ¢å™¨ï¼Œéœ€è¦åœ¨ç‰¹å®šçš„ä½ç½®åŠ ä¸Š@RequestBodyå’Œ@ResponseBodySpringMVCä¼šæ ¹æ®ä¼ å…¥çš„Content-Typeï¼Œå¯¹åº”çš„å€¼å°±å¯ä»¥å«åšæ˜¯Media Typeæ¥ç¡®å®šæ¶ˆæ¯è½¬æ¢å™¨ï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„è½¬æ¢å™¨ï¼Œè¯»åˆ™æŠ›å‡ºHttpMediaTypeNotSupportedExceptionï¼Œæµè§ˆå™¨ä¼šæ”¶åˆ°ä¸€ä¸ª415 Unsupported Media TypeçŠ¶æ€ç ï¼›å†™åˆ™æŠ›å‡ºHttpMediaTypeNotAcceptableExceptionå¼‚å¸¸ï¼Œæµè§ˆå™¨ä¼šæ”¶åˆ°ä¸€ä¸ª406 Not AcceptableçŠ¶æ€ç ã€‚ä¸¾ä¸ªä¾‹å­ @PostMapping(&quot;/testRequestBody&quot;) @ResponseBody public Object testRequestBody(@RequestBody User user) { return user; }åœ¨SpringMVCè¿›å…¥testRequestBodyæ–¹æ³•å‰ï¼Œä¼šæ ¹æ®@RequestBodyæ³¨è§£é€‰æ‹©é€‚å½“çš„HttpMessageConverterå®ç°ç±»æ¥å°†è¯·æ±‚å‚æ•°è§£æåˆ°Userå¯¹è±¡ä¸­ï¼Œå…·ä½“æ¥è¯´æ˜¯ä½¿ç”¨äº†MappingJackson2HttpMessageConverterç±»ï¼Œå®ƒçš„canRead()æ–¹æ³•è¿”å›trueï¼Œç„¶åå®ƒçš„read()æ–¹æ³•ä¼šä»è¯·æ±‚ä¸­è¯»å‡ºè¯·æ±‚å‚æ•°ï¼Œç»‘å®šåˆ°testRequestBody()æ–¹æ³•çš„Userå¯¹è±¡ä¸­ã€‚å½“SpringMVCæ‰§è¡ŒtestRequestBodyæ–¹æ³•åï¼Œç”±äºè¿”å›å€¼æ ‡è¯†äº†@ResponseBodyï¼ŒSpringMVCå°†ä½¿ç”¨MappingJackson2HttpMessageConverterçš„write()æ–¹æ³•ï¼Œå°†ç»“æœä½œä¸ºjsonå€¼å†™å…¥å“åº”æŠ¥æ–‡ï¼Œå½“ç„¶ï¼Œæ­¤æ—¶canWrite()æ–¹æ³•è¿”å›trueã€‚è¿ä½œæµç¨‹å¯¹äºæ¶ˆæ¯è½¬æ¢å™¨çš„è°ƒç”¨ï¼Œéƒ½æ˜¯åœ¨RequestResponseBodyMethodProcessorç±»ä¸­å®Œæˆçš„ï¼Œå¯¹äºè¿”å›å€¼çš„æ“ä½œhandleReturnValueè°ƒç”¨äº†AbstractMessageConverterMethodProcessorä¸­çš„writeWithMessageConvertersæ–¹æ³•ï¼Œç¡®å®šselectedMediaTypeåéå†æ¶ˆæ¯è½¬æ¢å™¨ï¼Œæ ¹æ®canWriteæ¥ç¡®å®šæ¶ˆæ¯è½¬æ¢å™¨ï¼Œå¹¶å¯¹è¿”å›å€¼è¿›è¡Œå¤„ç†ï¼›å¯¹äºè¯·æ±‚å€¼æ“ä½œè°ƒç”¨AbstractMessageConverterMethodArgumentResolverçš„readWithMessageConvertersæ–¹æ³•ï¼Œå¤„ç†æ–¹å¼ä¸€è‡´ã€‚å‚è€ƒæ–‡ç« ï¼šspringMVCçš„æ¶ˆæ¯è½¬æ¢å™¨ï¼ˆMessage Converterï¼‰Spring MVCç³»åˆ—ï¼ˆ9ï¼‰-HttpMessageConverteræŠ¥æ–‡è½¬æ¢æµç¨‹æºç è§£æ_äº‘çƒŸæˆé›¨TDçš„åšå®¢-CSDNåšå®¢Spring MVCç³»åˆ—ï¼ˆ10ï¼‰-ä½¿ç”¨fastjsonè‡ªå®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨_äº‘çƒŸæˆé›¨TDçš„åšå®¢-CSDNåšå®¢_fastjson è½¬æ¢å™¨SpringMVCæºç å‰–æï¼ˆäº”)-æ¶ˆæ¯è½¬æ¢å™¨HttpMessageConverter - ç›¸è§æ¬¢çš„ä¸ªäººç©ºé—´ - OSCHINA - ä¸­æ–‡å¼€æºæŠ€æœ¯äº¤æµç¤¾åŒº" }, { "title": "dockerä¸­elasticå¢åŠ å¯†ç è®¿é—®", "url": "/posts/docker%E4%B8%ADelastic%E5%A2%9E%E5%8A%A0%E5%AF%86%E7%A0%81%E8%AE%BF%E9%97%AE/", "categories": "", "tags": "docker, elasticsearch", "date": "2022-04-19 09:40:19 +0800", "snippet": "é…ç½®æ–‡ä»¶ä¿®æ”¹è¿›å…¥å®¹å™¨å†…éƒ¨sudo docker exec -it elastic /bin/bashviæ‰“å¼€config ä¸‹ elasticsearch.ymlå¢åŠ å®‰å…¨é…ç½®# é…ç½®X-Packhttp.cors.enabled: truehttp.cors.allow-origin: &quot;*&quot;http.cors.allow-headers: Authorizationxpack.security.enabled: truexpack.security.transport.ssl.enabled: trueé‡å¯dockerä¸­elasticdocker restart elasticä¿®æ”¹å¯†ç bin/elasticsearch-setup-passwords interactiveå› ä¸ºéœ€è¦è®¾ç½® elasticï¼Œapm_systemï¼Œkibanaï¼Œkibana_systemï¼Œlogstash_systemï¼Œbeats_systemï¼Œremote_monitoring_user è¿™äº›ç”¨æˆ·çš„å¯†ç éªŒè¯curl localhost:9200å‡ºç°å¦‚ä¸‹ä¿¡æ¯{&quot;error&quot;:{&quot;root_cause&quot;:[{&quot;type&quot;:&quot;security_exception&quot;,&quot;reason&quot;:&quot;missing authentication credentials for REST request [/]&quot;,&quot;header&quot;:{&quot;WWW-Authenticate&quot;:&quot;Basic realm=\\&quot;security\\&quot; charset=\\&quot;UTF-8\\&quot;&quot;}}],&quot;type&quot;:&quot;security_exception&quot;,&quot;reason&quot;:&quot;missing authentication credentials for REST request [/]&quot;,&quot;header&quot;:{&quot;WWW-Authenticate&quot;:&quot;Basic realm=\\&quot;security\\&quot; charset=\\&quot;UTF-8\\&quot;&quot;}},&quot;status&quot;:401}å¸¦ä¸Šç”¨æˆ·å¯†ç ä¿¡æ¯è®¿é—®åˆ™è¿”å›æ­£å¸¸ä¿¡æ¯curl localhost:9200 -u elastic:{password}RestHighLevelClienté…ç½®ä¿®æ”¹åç«¯ç”Ÿäº§ç¯å¢ƒå¢åŠ CredentialsProviderç”¨äºé…ç½®è´¦å·å¯†ç è®¿é—® HttpHost[] hh = clusterNodes.stream().map(x -&amp;gt; new HttpHost(x.split(&quot;:&quot;)[0], Integer.parseInt(x.split(&quot;:&quot;)[1]), &quot;http&quot;)).toArray(HttpHost[]::new); RestClientBuilder builder = RestClient.builder(hh); //å¢åŠ è´¦å·å¯†ç é…ç½® if (StringUtils.isNotBlank(userName) &amp;amp;&amp;amp; StringUtils.isNotBlank(password)) { CredentialsProvider credentialsProvider = new BasicCredentialsProvider(); credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(userName, password)); builder.setHttpClientConfigCallback(f -&amp;gt; f.setDefaultCredentialsProvider(credentialsProvider)); } RestHighLevelClient client = new RestHighLevelClient(builder); return client;å‰ç«¯è®¿é—®9200ç«¯å£éœ€è¦åœ¨headerä¸­å¢åŠ basicè®¤è¯æ‹¼æ¥ç”¨æˆ·åå¯†ç ä¿¡æ¯" }, { "title": "ã€æºç åˆ†æã€‘springsecurityå¯†ç æ¨¡å¼æ ¡éªŒå¯†ç ", "url": "/posts/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-springsecurity%E5%AF%86%E7%A0%81%E6%A8%A1%E5%BC%8F%E5%A6%82%E4%BD%95%E6%A0%A1%E9%AA%8C%E5%AF%86%E7%A0%81/", "categories": "", "tags": "springsecurity, oauth2", "date": "2022-04-12 09:39:00 +0800", "snippet": "oauth2è®¤è¯æµç¨‹TokenGranterç»™ç”¨æˆ·åˆ†å‘OAuth2AccessToken,æ ¹æ®grantType(password,authorization-code)å’ŒTokenRequestï¼ˆrequestParameters,clientId,grantTypeï¼‰æˆäºˆäººOAuth2AccessTokenä»¤ç‰Œã€‚å®ç°AbstractTokenGranterçš„ç±»æœ‰5ç§ã€‚å…¶ä¸­å¦‚æœç”¨passwordçš„æ–¹å¼è¿›è¡ŒéªŒè¯ï¼Œé‚£ä¹ˆTokenGranterç±»å‹æ˜¯ResourceOwnerPasswordTokenGranterï¼Œè¯¥ç±»ä¸­é‡å†™äº†getOAuth2Authenticationæ–¹æ³•ï¼Œé‡Œé¢è°ƒç”¨äº†authenticationManager.authenticate()æ–¹æ³•ã€‚userAuth = this.authenticationManager.authenticate(userAuth);ç”¨æˆ·å¯è‡ªè¡Œå®šä¹‰granterç±»ç»§æ‰¿AbstractTokenGranterï¼Œé‡å†™getOAuth2Authentication()æ–¹æ³•ï¼Œå¹¶å°†è¯¥granterç±»æ·»åŠ è‡³CompositeTokenGranterä¸­ã€‚äº”ç§å®ç°ç±»å¦‚ä¸‹å›¾ï¼šå¯†ç æ¨¡å¼æºç åˆ†æéªŒè¯ç ç”¨æˆ·åå¯†ç è°ƒç”¨ AbstractUserDetailsAuthenticationProviderä¸­çš„authenticateæ–¹æ³•ï¼Œè‡³äºä¸ºä»€ä¹ˆè°ƒç”¨è¿™ä¸ªæœåŠ¡ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°å…¶ç¼ºçœå®ç° ProviderManagerä¸­ä¸€è¡Œä»£ç if (provider.supports(toTest))å³è¡¨ç¤ºå¦‚æœæœåŠ¡æ”¯æŒ toTest è¿™ä¸ªç±»å‹ï¼š Class&amp;lt;? extends Authentication&amp;gt; toTest = authentication.getClass();é‚£ä¹ˆå®ƒå°±ä¼šè°ƒç”¨è¿™ä¸ªæœåŠ¡çš„è®¤è¯æ–¹æ³•ï¼šresult = provider.authenticate(authentication);supports æ–¹æ³•æ˜¯æ¥å£AuthenticationProviderä¸­çš„ä¸€ä¸ªæ–¹æ³•ã€‚æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªå®ç°ç±»ï¼Œä»¥AbstractUserDetailsAuthenticationProvideræŠ½è±¡ç±»ä¸ºä¾‹è¿™ä¸ªæ–¹æ³•çš„å®ç°è¡¨ç¤ºè¿™ä¸ªæœåŠ¡æ”¯æŒ UsernamePasswordAuthenticationToken è¿™ä¸ªç±»å‹çš„Tokenreturn UsernamePasswordAuthenticationToken.class.isAssignableFrom(authentication);å½“ä¼ å…¥çš„Tokenç±»å‹æ˜¯UsernamePasswordAuthenticationTokenå¹¶ä¸”åœ¨æœåŠ¡åˆ—è¡¨ä¸­å¾ªç¯åˆ°è¿™ä¸ªæœåŠ¡çš„å…·ä½“å®ç°æœåŠ¡æ—¶ï¼Œå°±ä¼šè§¦å‘è¯¥å®ç°çš„è®¤è¯æ–¹æ³•å¯†ç æ ¡éªŒAbstractUserDetailsAuthenticationProviderä¸­authenticateæ–¹æ³•å…ˆå»è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè°ƒç”¨è‡ªå®šä¹‰çš„UserDetailsServiceä¸­loadUserByUsernameæ–¹æ³•ï¼Œç„¶ååœ¨å¯¹å¯†ç è¿›è¡Œæ ¡éªŒæ“ä½œ //è·å–ç”¨æˆ·ä¿¡æ¯ user = retrieveUser(username,(UsernamePasswordAuthenticationToken) authentication); â€¦â€¦ â€¦â€¦ this.preAuthenticationChecks.check(user); #ç”¨äºæ ¡éªŒå¯†ç  this.additionalAuthenticationChecks(user, (UsernamePasswordAuthenticationToken)authentication);è°ƒç”¨äº†DaoAuthenticationProviderä¸­çš„éªŒè¯å¯†ç æ–¹æ³• protected void additionalAuthenticationChecks(UserDetails userDetails, UsernamePasswordAuthenticationToken authentication) throws AuthenticationException { if (authentication.getCredentials() == null) { this.logger.debug(&quot;Authentication failed: no credentials provided&quot;); throw new BadCredentialsException(this.messages.getMessage(&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;, &quot;Bad credentials&quot;)); } else { String presentedPassword = authentication.getCredentials().toString(); if (!this.passwordEncoder.matches(presentedPassword, userDetails.getPassword())) { this.logger.debug(&quot;Authentication failed: password does not match stored value&quot;); throw new BadCredentialsException(this.messages.getMessage(&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;, &quot;Bad credentials&quot;)); } } }å‚è€ƒé“¾æ¥ï¼šOAuth2 æºç åˆ†æ(ä¸€.æ ¸å¿ƒç±»ï¼‰SpringCloud - Oauth2å¢åŠ çŸ­ä¿¡éªŒè¯ç éªŒè¯ç™»å½•" }, { "title": "ã€å¾®æœåŠ¡ä¸“é¢˜ã€‘springboot springsecurity oauth2è‡ªå®šä¹‰å¼‚å¸¸", "url": "/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%93%E9%A2%98-springboot-springsecurity-oauth2%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8/", "categories": "", "tags": "springboot, springsecurity, oauth2", "date": "2022-04-11 10:28:34 +0800", "snippet": "oauth2è®¤è¯æµç¨‹è°ƒç”¨è®¤è¯ä¸­å¿ƒçš„/oauth/tokenï¼Œheaderä¸­å¸¦ä¸Šbasicè®¤è¯çš„clientidå’Œsecret;ç”¨æˆ·åå¯†ç æ¨¡å¼å¯¹åº”çš„DaoAuthenticationProviderï¼Œå®šä¹‰äº†UserDetailsServiceæ¥è·å–ç”¨æˆ·ä¿¡æ¯å’Œå¯†ç æ¨¡å¼passwordEncoder;è·å–ä¿¡æ¯å¤±è´¥æˆ–è€…è®¤è¯é”™è¯¯ç”¨DefaultWebResponseExceptionTranslatoræ¥è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œå®ç°çš„æ¥å£WebResponseExceptionTranslatorï¼Œtranslateæ–¹æ³•ç”¨äºå¼‚å¸¸å¤„ç†ã€‚è¦å®ç°è‡ªå®šä¹‰å¼‚å¸¸ï¼Œæˆ‘ä»¬ç»§æ‰¿åé‡å†™æ–¹æ³•å³å¯ã€‚è‡ªå®šä¹‰å¼‚å¸¸è¾“å‡º1.é‡å†™translateæ¥è‡ªå®šä¹‰å¼‚å¸¸/** * @author TAO * @description: SpringSecurity OAuth2 å¼‚å¸¸ç¿»è¯‘å™¨ï¼Œç»Ÿä¸€æ•è·æˆæƒæ—¶å¼‚å¸¸ä¿¡æ¯å¤„ç† * @date 2021/10/1 16:14 */@Slf4j@Componentpublic class Auth2ResponseExceptionTranslator implements WebResponseExceptionTranslator { private ThrowableAnalyzer throwableAnalyzer = new DefaultThrowableAnalyzer(); @Override public ResponseEntity translate(Exception e) throws Exception { Throwable[] causeChain = throwableAnalyzer.determineCauseChain(e); Exception ase = null;// å¼‚å¸¸æ ˆè·å– OAuth2Exception å¼‚å¸¸ ase= (AuthenticationException) throwableAnalyzer.getFirstThrowableOfType(AuthenticationException.class, causeChain); if (ase != null) { return handleOAuth2Exception(new ExtendOAuth2Exception(e.getMessage(), e)); } ase = (UnsupportedGrantTypeException) throwableAnalyzer .getFirstThrowableOfType(UnsupportedGrantTypeException.class, causeChain); if (ase != null) { return handleOAuth2Exception(new ExtendOAuth2Exception(e.getMessage(), e)); } ase = (AccessDeniedException) throwableAnalyzer.getFirstThrowableOfType(AccessDeniedException.class, causeChain); if (ase != null) { return handleOAuth2Exception(new ExtendOAuth2Exception(ase.getMessage(), ase)); } ase = (HttpRequestMethodNotSupportedException) throwableAnalyzer .getFirstThrowableOfType(HttpRequestMethodNotSupportedException.class, causeChain); if (ase != null) { return handleOAuth2Exception(new ExtendOAuth2Exception(ase.getMessage(), ase)); } ase = (OAuth2Exception) throwableAnalyzer.getFirstThrowableOfType(OAuth2Exception.class, causeChain); if (ase != null) { return handleOAuth2Exception((OAuth2Exception) ase); } // ä¸åŒ…å«ä¸Šè¿°å¼‚å¸¸åˆ™æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ return handleOAuth2Exception(new ExtendOAuth2Exception(HttpStatus.INTERNAL_SERVER_ERROR.getReasonPhrase(), e)); } private ResponseEntity&amp;lt;OAuth2Exception&amp;gt; handleOAuth2Exception(OAuth2Exception e) { int status = e.getHttpErrorCode(); HttpHeaders headers = new HttpHeaders(); headers.set(&quot;Cache-Control&quot;, &quot;no-store&quot;); headers.set(&quot;Pragma&quot;, &quot;no-cache&quot;); if (status == HttpStatus.UNAUTHORIZED.value() || (e instanceof InsufficientScopeException)) { headers.set(&quot;WWW-Authenticate&quot;, String.format(&quot;%s %s&quot;, OAuth2AccessToken.BEARER_TYPE, e.getSummary())); } return new ResponseEntity&amp;lt;&amp;gt;(new ExtendOAuth2Exception(e.getMessage(),e), headers, HttpStatus.valueOf(status)); }}2.å¼‚å¸¸ç»§æ‰¿ç±»ä»¥åŠåºåˆ—åŒ–ç±»æ‰©å±•OAuth2Exception/*** @description: æ‰©å±•OAuth2Exception* @author TAO* @date 2021/9/29 22:14*/@JsonSerialize(using = ExtendOAuth2ExceptionSerializer.class)public class ExtendOAuth2Exception extends OAuth2Exception { @Getter private String dataMsg; public ExtendOAuth2Exception(String msg) { super(msg); } public ExtendOAuth2Exception(String msg, Throwable t) { super(msg, t); } public ExtendOAuth2Exception(String msg, String dataMsg) { super(msg); this.dataMsg = dataMsg; }}ExtendOAuth2Exceptionè¿”å›æ ¼å¼åºåˆ—åŒ–/*** @description: ExtendOAuth2Exceptionè¿”å›æ ¼å¼åºåˆ—åŒ–* @author TAO* @date 2021/9/29 22:42*/public class ExtendOAuth2ExceptionSerializer extends StdSerializer&amp;lt;ExtendOAuth2Exception&amp;gt; { public ExtendOAuth2ExceptionSerializer() { super(ExtendOAuth2Exception.class); } @Override public void serialize(ExtendOAuth2Exception e, JsonGenerator gen, SerializerProvider serializerProvider) throws IOException { gen.writeStartObject(); gen.writeObjectField(&quot;code&quot;, String.valueOf(e.getHttpErrorCode())); gen.writeStringField(&quot;msg&quot;, e.getMessage()); gen.writeStringField(&quot;data&quot;, e.getDataMsg()); gen.writeEndObject(); }}3.é…ç½®è‡ªå®šä¹‰å¼‚å¸¸è§£æå™¨ /** * è®¿é—®ç«¯ç‚¹é…ç½®ã€‚tokenStoreã€tokenEnhanceræœåŠ¡ */ @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception { TokenEnhancerChain tokenEnhancerChain = new TokenEnhancerChain(); List&amp;lt;TokenEnhancer&amp;gt; tokenEnhancers = new ArrayList&amp;lt;&amp;gt;(); tokenEnhancers.add(tokenEnhancer()); tokenEnhancerChain.setTokenEnhancers(tokenEnhancers); endpoints.allowedTokenEndpointRequestMethods(HttpMethod.GET, HttpMethod.POST) //æ”¯æŒè¯·æ±‚ .tokenEnhancer(tokenEnhancerChain)//tokenå¢å¼º .authenticationManager(authenticationManager)//å¯†ç æ¨¡å¼ .tokenStore(tokenStore())//tokenå­˜å…¥redis .exceptionTranslator(new Auth2ResponseExceptionTranslator()) // è®¾ç½®è‡ªå®šä¹‰çš„å¼‚å¸¸è§£æå™¨ .userDetailsService(userDetailsService); }è‡³æ­¤ï¼Œsecurity oauth2è®¤è¯å·²ç»èƒ½è¿”å›æŒ‡å®šæ ¼å¼çš„è¿”å›ä½“{ &quot;code&quot;: &quot;400&quot;, &quot;msg&quot;: &quot;Unsupported grant type: password1&quot;, &quot;data&quot;: null}UsernameNotFoundExceptionæ— æ³•æŠ›å‡ºçš„é—®é¢˜ç»è¿‡å¯¹æºç çš„åˆ†æ ï¼ŒhideUserNotFoundExceptionså†³å®šäº†æ˜¯å¦è½¬æ¢å¼‚å¸¸ç±»å‹ã€‚AbstractUserDetailsAuthenticationProvider.class try { user = retrieveUser(username, (UsernamePasswordAuthenticationToken) authentication); } catch (UsernameNotFoundException notFound) { logger.debug(&quot;User &#39;&quot; + username + &quot;&#39; not found&quot;); if (hideUserNotFoundExceptions) { throw new BadCredentialsException(messages.getMessage( &quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;, &quot;Bad credentials&quot;)); } else { throw notFound; } }è§£å†³æ–¹æ³•å°±æ˜¯æŠŠå®ç°ç±»ä¸­hideUserNotFoundExceptionsä¿®æ”¹å€¼ä¸ºfalseï¼Œå¹¶ä¸”æ›¿æ¢æ‰é»˜è®¤çš„ã€‚public class WebSecurityConfig extends WebSecurityConfigurerAdapter { private UserDetailsService userDetailsService; /** * ç”¨æˆ·éªŒè¯ */ @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { //æ›¿æ¢é»˜è®¤DaoAuthenticationProvider auth.authenticationProvider(authenticationProvider()); } /** * ç”¨äºæŠ›å‡ºUsernameNotFoundException */ @Bean public DaoAuthenticationProvider authenticationProvider() { DaoAuthenticationProvider provider = new DaoAuthenticationProvider(); provider.setHideUserNotFoundExceptions(false); provider.setUserDetailsService(userDetailsService); provider.setPasswordEncoder(passwordEncoder()); return provider; }å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬åœ¨loadUserByUsernameä¸­æŠ›å‡ºçš„å¼‚å¸¸å¯ä»¥æ­£å¸¸åé¦ˆ{ &quot;code&quot;: &quot;400&quot;, &quot;msg&quot;: &quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;, &quot;data&quot;: null}" }, { "title": "macä¸Šdocker mysqlå¯åŠ¨é”™è¯¯é—®é¢˜æ’æŸ¥", "url": "/posts/mac%E4%B8%8Adocker-mysql%E5%90%AF%E5%8A%A8%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/", "categories": "", "tags": "docker, mysql, mac", "date": "2022-04-06 16:25:54 +0800", "snippet": "é—®é¢˜mbpç‰ˆæœ¬2021æ¬¾14å¯¸m1 proèŠ¯ç‰‡ï¼Œç³»ç»ŸMontereyï¼Œä»Šå¤©çªç„¶å‘ç°æœ¬åœ°dockerä¸­çš„mysqlå¯åŠ¨å¤±è´¥ï¼Œå…·ä½“æŠ¥é”™å¦‚ä¸‹Error invoking remote method &#39;docker-start-container&#39;: Error: (HTTP code 500) server error - error while creating mount source path &#39;/host_mnt/private/var/db/timezone/tz/2021a.3.0/zoneinfo/Asia/Shanghai&#39;: mkdir /host_mnt/private/var/db/timezone/tz/2021a.3.0: operation not permittedæ’æŸ¥çœ‹äº†ä¸‹å¤§æ¦‚æ˜¯æŒ‚è½½çš„æ—¶é—´æœ‰é—®é¢˜ï¼Œåˆ›å»ºçš„æ—¶å€™åˆæ²¡æƒé™ï¼ŒæŸ¥äº†ä¸‹æœ¬åœ°ç›®å½•ä¸‹ç¡®å®æ²¡è¿™ä¸ª2021a.3.0æ–‡ä»¶å¤¹,ä½†æ˜¯mysqlæŒ‚è½½çš„æ˜¯/etc/localtimeï¼Œæ˜ å°„åˆ°å…·ä½“çš„æ—¶é—´æ˜¯2022a.1.0,ä¸çŸ¥é“dockeræŠ½ä»€ä¹ˆé£ï¼Œé‡å¯éƒ½ä¸å¥½ä½¿.è°·æ­Œæœäº†ä¸€åœˆçœ‹åˆ°ä¸€ä¸ªå·®ä¸å¤šçš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•æ˜¯å¤åˆ¶ä¸€ä»½æ”¹åå­—ã€‚å°è¯•äº†ä¸€ä¸‹ï¼Œmacæœ‰sipå®Œæ•´æ€§ä¿æŠ¤ï¼Œç³»ç»Ÿçº§åˆ«çš„æ–‡ä»¶å¤¹éƒ½ä¸å…è®¸æ“ä½œï¼Œäºæ˜¯å…³é—­sip,å…·ä½“æ–¹å¼æ˜¯é‡å¯åé•¿æŒ‰å¼€æœºé”®ï¼Œè¿›å…¥ç³»ç»Ÿç»ˆç«¯é‡Œè¿è¡Œå‘½ä»¤csrutil disableå…³é—­ã€‚è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæˆåŠŸåˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå†è¿è¡Œmysqlé•œåƒæˆåŠŸè·‘èµ·æ¥äº†ã€‚sudo cp -rfp /private/var/db/timezone/tz/2022a.1.0 /private/var/db/timezone/tz/2021a.3.0" }, { "title": "dockerå®šæœŸå¤‡ä»½mysql", "url": "/posts/docker%E5%AE%9A%E6%9C%9F%E5%A4%87%E4%BB%BDmysql/", "categories": "", "tags": "è¿ç»´, linux, mysql", "date": "2022-03-30 08:24:21 +0800", "snippet": "åŸå› è¿™ä¸æ˜¯å‰é¢è¿ç§»äº†ä¸¤ä¸ªç³»ç»Ÿå—ã€‚æ‰€æœ‰è¿ç»´éƒ½å¾—è‡ªå·±æ¥ï¼Œæ•°æ®æ— ä»·ï¼Œä¸ºäº†é˜²æ­¢çŒªé˜Ÿå‹æ“ä½œï¼Œæ‰€ä»¥å‡†å¤‡å®šæœŸå¤‡ä»½mysqlæ•°æ®ã€‚å°±åœ¨å¤‡ä»½å®Œçš„ä¹‹ånå¤©ï¼Œæ–°å…¥èŒçš„å¼ ä¸‰å°±æŠŠæµ‹è¯•åº“å¯¼åˆ°ç”Ÿäº§åº“äº†ï¼Œå¾—ï¼Œæˆ‘å°±æ˜¯é¢„è¨€å®¶ã€‚mysqlè®¾ç½®é¦–å…ˆï¼Œmysqlå¤‡ä»½ç”¨åˆ°mysqldumpå‘½ä»¤ï¼Œéœ€è¦åœ¨mysqlé…ç½®æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹é…ç½®ï¼Œå¦åˆ™éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­åŠ ä¸Šç”¨æˆ·å¯†ç ã€‚[mysqldump]user=xxxpassword=xxxè„šæœ¬ æ³¨æ„ç‚¹ï¼šä»¥ä¸‹æ‰€æœ‰æ“ä½œéƒ½ä¸ºrootæƒé™ã€‚vim mysqlback.shå¤åˆ¶ç²˜è´´å¦‚ä¸‹è„šæœ¬# ä¿ç•™10å¤©æ•°æ®ï¼Œ# mysql-serviceä¸ºå®‰è£…dockerä¸­mysqlæœåŠ¡åç§°docker exec -i mysql-service bash&amp;lt;&amp;lt;&#39;EOF&#39;# åˆ¤æ–­ç›®å½•æ˜¯ä¸æ˜¯å·²ç»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºif [ ! -d &quot;/backups/mysql&quot; ]; then mkdir -p /backups/mysqlfi# xxx ä¸ºæ•°æ®åº“çš„åç§°mysqldump xxx &amp;gt; /backups/mysql/backups_$(date +%Y%m%d).sql#åˆ é™¤è¶…è¿‡10å¤©çš„æ•°æ®rm -f /backups/mysql/backups_$(date -d -10day +%Y%m%d).sqlexitEOF# å®¿ä¸»æœºæ“ä½œï¼šåˆ¤æ–­ç›®å½•æ˜¯ä¸æ˜¯å·²ç»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºif [ ! -d &quot;/home/admin/backups/mysql&quot; ]; then mkdir -p /home/admin/backups/mysqlfi# å°†dockerä¸­çš„å¤‡ä»½çš„æ•°æ®æ‹·è´åˆ°å®¿ä¸»æœºä¸Šã€‚docker cp mysql-service:/backups/mysql/backups_$(date +%Y%m%d).sql /home/admin/backups/mysql#åˆ é™¤è¶…è¿‡10å¤©çš„æ•°æ®rm -f /home/admin/backups/mysql/backups_$(date -d -10day +%Y%m%d).sqlå®šæ—¶ä»»åŠ¡æ‰“å¼€å®šæ—¶ä»»åŠ¡é…ç½®crontab -eå¢åŠ å¦‚ä¸‹å‘½ä»¤59 23 * * * sh /home/admin/env/mysqlbak.sh" }, { "title": "centos7å…è®¸æŒ‡å®šipè®¿é—®ç«¯å£", "url": "/posts/centos7%E5%85%81%E8%AE%B8%E6%8C%87%E5%AE%9Aip%E8%AE%BF%E9%97%AE%E7%AB%AF%E5%8F%A3/", "categories": "", "tags": "è¿ç»´, linux", "date": "2022-03-11 09:38:33 +0800", "snippet": "èµ·å› éƒ¨ç½²åœ¨ç³»ç»Ÿå†…ç½‘çš„ç¯å¢ƒè¢«æ‰«æåˆ°mysql5.7.26å­˜åœ¨è¯¸å¤šå®‰å…¨é—®é¢˜ï¼Œsshç«¯å£ä¹Ÿå­˜åœ¨å®‰å…¨éšæ‚£ï¼Œæ—¢ç„¶æ˜¯å†…ç½‘åº”ç”¨ï¼Œé‚£å°±æŒ‡å®šåº”ç”¨ipè®¿é—®ç«¯å£å³å¯ã€‚è§£å†³æ­¥éª¤centos7ç”¨çš„æ˜¯firewallé˜²ç«å¢™ï¼Œå¼€å¯é˜²ç«å¢™ï¼Œå¯¹æŒ‡å®šç«¯å£é™åˆ¶ipè®¿é—®å³å¯ï¼Œmysql 3306ç«¯å£ç”¨äºè¿œç¨‹è®¿é—®ï¼Œsshç«¯å£10022ç”¨äºè¿ç»´ã€‚#è®¾ç½®æŒ‡å®šipè®¿é—®ç«¯å£firewall-cmd --permanent --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;xxxx&quot; port protocol=&quot;tcp&quot; port=&quot;10022&quot; accept&quot;firewall-cmd --permanent --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;xxxx&quot; port protocol=&quot;tcp&quot; port=&quot;3306&quot; accept&quot;firewall-cmd --reload#ç§»é™¤é˜²ç«å¢™å¼€å¯çš„ç«¯å£firewall-cmd --permanent --zone=public --remove-port=10022/tcpfirewall-cmd --reload#é‡å¯é˜²ç«å¢™firewall-cmd --reload#æŸ¥çœ‹ç«¯å£firewall-cmd --zone=public --list-ports#æ·»åŠ ç«¯å£firewall-cmd --permanent --zone=public --add-port=3306/tcp#åˆ é™¤ç«¯å£firewall-cmd --permanent --zone=public --remove-port=10022/tcp#æŸ¥çœ‹è§„åˆ™firewall-cmd --list-rich-rules#æ·»åŠ è§„åˆ™firewall-cmd --permanent --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;xxxx&quot; port protocol=&quot;tcp&quot; port=&quot;10022&quot; accept&quot;#åˆ é™¤è§„åˆ™firewall-cmd --permanent --remove-rich-rule &#39;æŸ¥çœ‹è§„åˆ™å†…å®¹&#39;å¯åŠ¨ï¼šsystemctl start firewalldå…³é—­ï¼šsystemctl stop firewalldæŸ¥çœ‹çŠ¶æ€ï¼šsystemctl status firewalldå¼€æœºç¦ç”¨ï¼šsystemctl disable firewalldå¼€æœºå¯ç”¨ï¼šsystemctl enable firewalldç«¯å£è½¬å‘æ·»åŠ ï¼ˆä¾‹å¦‚3306 -&amp;gt; 3336ï¼‰ï¼šfirewall-cmd --permanent --zone=public --add-forward-port=port=3336:proto=tcp:toport=3306:toaddr=åˆ é™¤ï¼šfirewall-cmd --permanent --remove-forward-port=port=3306:proto=tcp:toport=3336:toaddr=æŸ¥çœ‹è½¬å‘çš„ç«¯å£ï¼šfirewall-cmd --list-forward-portsåç»­é—®é¢˜ç…§è¯´æ”¹è¿‡äº†æ²¡é—®é¢˜ï¼Œä¸Šæ¬¡æµ‹è¯•äº†ä¸¤å°æœºå™¨ä¹Ÿæ— æ³•telneté€šå¯¹åº”ç«¯å£ï¼›ä½†æ˜¯åœ¨åä¸€æ¬¡æ‰«æåè¿˜æ˜¯æš´éœ²äº†ä¸€äº›æ¼æ´ï¼Œç»è¿‡æ’æŸ¥ï¼Œdockeré‡å¯åä¼šç»•å¼€é˜²ç«å¢™å¼€å¯è®¿é—®ã€‚è¿™æ˜¯å› ä¸ºdocker é»˜è®¤ç”¨çš„æ˜¯iptable(ç”¨æˆ·æ€)å®¢æˆ·ç«¯å·¥å…·ç®¡ç†çš„dockerçš„filterï¼Œå¦‚æœsystemctl start docker åœ¨systemctl start firewalld è¿™æ ·ä¼šæŠŠdockerçš„è§„åˆ™ç ´åï¼Œä¸»è¦æ˜¯FORWARDè§„åˆ™ç ´åï¼Œæ¯”è¾ƒçœäº‹çš„æ“ä½œå°±æ˜¯å…³é—­dockerçš„iptablesã€‚vim /etc/docker/daemon.jsonæ·»åŠ å¦‚ä¸‹è§„åˆ™{ &quot;iptables&quot;:false}é‡å¯dockersystemctl restart docker" }, { "title": "dockerç¯å¢ƒå®‰è£…ä»¥åŠå¸¸è§ä¸­é—´ä»¶éƒ¨ç½²", "url": "/posts/docker%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8A%E5%B8%B8%E8%A7%81%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%83%A8%E7%BD%B2/", "categories": "", "tags": "è¿ç»´", "date": "2022-03-07 23:31:57 +0800", "snippet": "å®‰è£…dockerï¼ˆç¦»çº¿æ–¹å¼ï¼‰1.ä¸‹è½½ Docker2.è§£å‹å‹ç¼©æ–‡ä»¶tar -zxvf docker-19.03.8.tgz3.å°†è§£å‹å¥½çš„ Docker æ–‡ä»¶å¤åˆ¶åˆ° /usr/bin ç›®å½•ä¸‹cp docker/* /usr/bin/4.å°† docker æ³¨å†Œä¸ºæœåŠ¡vim /etc/systemd/system/docker.serviceè¾“å…¥ä»¥ä¸‹å†…å®¹[Unit]Description=Docker Application Container EngineDocumentation=https://docs.docker.comAfter=network-online.target firewalld.serviceWants=network-online.target [Service]Type=notify# the default is not to use systemd for cgroups because the delegate issues still# exists and systemd currently does not support the cgroup feature set required# for containers run by dockerExecStart=/usr/bin/dockerd --selinux-enabled=false --insecure-registry=127.0.0.1ExecReload=/bin/kill -s HUP $MAINPID# Having non-zero Limit*s causes performance problems due to accounting overhead# in the kernel. We recommend using cgroups to do container-local accounting.LimitNOFILE=infinityLimitNPROC=infinityLimitCORE=infinity# Uncomment TasksMax if your systemd version supports it.# Only systemd 226 and above support this version.#TasksMax=infinityTimeoutStartSec=0# set delegate yes so that systemd does not reset the cgroups of docker containersDelegate=yes# kill only the docker process, not all processes in the cgroupKillMode=process# restart the docker process if it exits prematurelyRestart=on-failureStartLimitBurst=3StartLimitInterval=60s [Install]WantedBy=multi-user.target æ­¤å¤„çš„â€“insecure-registry=127.0.0.1ï¼ˆæ­¤å¤„æ”¹æˆä½ ç§æœipï¼‰è®¾ç½®æ˜¯é’ˆå¯¹æœ‰æ­å»ºäº†è‡ªå·±ç§æœHarboræ—¶å…è®¸dockerè¿›è¡Œä¸å®‰å…¨çš„è®¿é—®ï¼Œå¦åˆ™è®¿é—®å°†ä¼šè¢«æ‹’ç»ã€‚5.å¯åŠ¨ docker ä¸º docker.service æ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™ chmod +x /etc/systemd/system/docker.service é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ systemctl daemon-reload å¯åŠ¨ systemctl start docker è®¾ç½®å¼€æœºå¯åŠ¨ systemctl enable docker.service æŸ¥çœ‹ docker æœåŠ¡çŠ¶æ€ systemctl status docker å¦‚ä½•ç¦»çº¿å®‰è£…dockeré•œåƒdockerä»“åº“åœ°å€ åœ¨å¤–ç½‘æœºå™¨ä¸Šæ‹‰å–é•œåƒå¹¶æŸ¥çœ‹ docker images å°†é•œåƒæ‰“åŒ…æˆtarå‹ç¼©æ–‡ä»¶,ä½¿ç”¨llå‘½åå¯ä»¥çœ‹åˆ°æ‰“åŒ…å¥½çš„æ–‡ä»¶docker save -o mysql-5.7.26.tar mysql:5.7.26 å°†æ‰“åŒ…å¥½çš„taræ–‡ä»¶ä¸‹è½½åˆ°Uç›˜ç­‰ä»‹è´¨(ä½¿ç”¨ftpå·¥å…·) æ‹·è´åˆ°å†…ç½‘linuxå¹¶è½½å…¥docker docker load -i mysql-5.7.26.tarmysqlé•œåƒå®‰è£…1ã€æŒ‚è½½å¤–éƒ¨é…ç½®å’Œæ•°æ®å®‰è£…mkdir -p /data/docker/mysql &amp;amp;&amp;amp; mkdir -p /data/docker/mysql/logs &amp;amp;&amp;amp; mkdir -p /data/docker/mysql/data/åˆ›å»ºmy.cnfé…ç½®æ–‡ä»¶vim /data/docker/mysql/my.cnfå†…å®¹ï¼š[mysqld]user=mysqlcharacter-set-server=utf8default_authentication_plugin=mysql_native_passwordsecure_file_priv=/var/lib/mysqlexpire_logs_days=7sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTIONmax_connections=1000[client]default-character-set=utf8[mysql]default-character-set=utf82.å¯åŠ¨é•œåƒdocker run --restart=always -d \\-v /data/docker/mysql/data/:/var/lib/mysql \\-v /data/docker/mysql/logs:/var/log/mysql \\-v /data/docker/mysql/my.cnf:/etc/mysql/my.cnf \\-v /etc/localtime:/etc/localtime \\-p 23306:3306 --name mysql-service -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7.26 --lower_case_table_names=1 3.è¿›å…¥é•œåƒdocker exec -it mysql-service bashdocker å®¹å™¨ ä¿®æ”¹mysqlå¯†ç 1.è¿›å…¥ mysql å®¹å™¨docker exec -it mysql-service /bin/bash4.é‡æ–°è¿›å…¥å®¹å™¨è¾“å…¥å‘½ä»¤rootä¸ºç”¨æˆ·å é»˜è®¤å¯†ç mysql -u root -p5.ä¿®æ”¹å¯†ç çš„å‘½ä»¤update mysql.user set authentication_string=password(&#39;æ–°å¯†ç &#39;) where user=&#39;root&#39; ;FLUSH PRIVILEGES;Â 6.å¼€å¯è¿œç¨‹è®¿é—®use mysql;Â grant all privileges on *.* to &#39;root&#39;@&#39;%&#39; identified by &#39;xxx&#39; with grant option;FLUSH PRIVILEGES;Â 7.å¯¼å…¥æ–‡ä»¶docker cp solutiondocker.sql mysql-service:/tmp/è¿›å…¥mysql é€‰æ‹©æ•°æ®åº“ç„¶åsource ä¹‹å‰çš„æ–‡ä»¶æœ¬æœºè¿œç¨‹ç™»å½•å‘½ä»¤Â mysql -h 127.0.0.1 -P 23306 -uroot -p8.æ•°æ®å¯¼å‡ºdocker exec -it mysql-service mysqldump -uroot -pPassword solution_manage &amp;gt; /home/admin/env/docker_db.sqlredisé•œåƒå®‰è£…1.é…ç½®æ–‡ä»¶ç§»åˆ°redisç›®å½•ä¸‹mkdir -p /data/docker/redis/data2.å¯åŠ¨é•œåƒdocker run -p 6379:6379 --name redis-service --privileged=true --restart always \\-v /data/docker/redis/redis.conf:/etc/redis/redis.conf \\-v /data/docker/redis/data:/data \\-d redis:5-alpine3.13 --appendonly yes --requirepass rootÂ å®‰è£…nginx+fastdfs1.æŸ¥çœ‹fastdfsçš„é•œåƒdocker search fastdfs2.æ‹‰å–é•œåƒdocker pull delron/fastdfsè¿™ä¸ªç‰ˆæœ¬çš„é•œåƒæ˜¯æ¯”è¾ƒå…¨çš„ï¼Œå«æœ‰fastdfsä»¥åŠnginxä»¥åŠå…¶ç›¸å…³çš„é…ç½®ã€‚3.å¯åŠ¨trackeræœåŠ¡docker run --restart=always -d --network=host --name tracker -v /home/admin/env/fdfs/tracker:/var/fdfs -v /etc/localtime:/etc/localtime delron/fastdfs tracker4.å¯åŠ¨storageæœåŠ¡ ipä¸å¯ä»¥ç”¨127.0.0.1 ,è¿™ä¸ªé•œåƒå†…éƒ¨å«æœ‰nginxçš„ç›¸å…³æ¨¡å— å¦‚æœéœ€è¦å…¬ç½‘è®¿é—®ï¼Œéœ€è¦è®¾ç½®ä¸ºå…¬ç½‘ipï¼Œä¸”22122,23000ï¼Œ8888ç«¯å£éœ€è¦å¼€æ”¾å®‰å…¨ç»„æˆ–è€…é˜²ç«å¢™ã€‚docker run --restart=always -d --network=host --name storage -e TRACKER_SERVER=172.16.0.83:22122 -v /home/admin/env/fdfs/storage:/var/fdfs -v /etc/localtime:/etc/localtime delron/fastdfs storage5.æŸ¥çœ‹å¯åŠ¨åçš„çŠ¶æ€docker ps -a6.ä¿®æ”¹nginxç«¯å£ï¼ˆè¿™é‡Œé»˜è®¤æ˜¯8888ï¼‰â€“ä¹Ÿå¯ä»¥ä¸ä¿®æ”¹è¿™é‡Œä»¥ä¿®æ”¹ä¸º8874ä¸ºä¾‹å­ï¼š6.1.è¿›å…¥storageå®¹å™¨ï¼šdocker exec -it storage bashfdfs_monitor /etc/fdfs/storage.conf6.2.ä¿®æ”¹storageå†…éƒ¨http.server_port,vi /etc/fdfs/storage.conf,å¯ä»¥çœ‹åˆ°åœ¨æœ€åä¸€è¡Œ http.server_port=8888ï¼Œå°†å…¶æ”¹æˆä¸ºhttp.server_port=8874å³å¯ã€‚6.3.å› ä¸ºä¿®æ”¹äº†storageï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¿®æ”¹nginxï¼Œä¿æŒä¸€è‡´ï¼švi /usr/local/nginx/conf/nginx.confï¼Œç„¶åå°†å…¶å†…éƒ¨çš„ server {listen 8888; â€¦} æ”¹æˆ server {listen 8874; â€¦}6.4.å‘½ä»¤é€€å‡º:exit7.æœ€åéœ€è¦é‡å¯å®¹å™¨ï¼šdocker restart storage8.æµ‹è¯•æ˜¯å¦é…ç½®æˆåŠŸæ‹·è´ä¸€ä¸ªtxtæ–‡ä»¶åˆ°ç›®å½•/var/fdfs è¿›å…¥storageå®¹å™¨ï¼šdocker exec -it storage bashè¿›å…¥fdfsç›®å½•ï¼šcd /var/fdfsè¿è¡Œå‘½ä»¤ï¼š/usr/bin/fdfs_upload_file /etc/fdfs/client.conf test.txtè¿è¡ŒæˆåŠŸåä¼šè¿”å›åœ°å€ï¼š group1/M00/00/00/rBFYll7Qw7uAPuhdAAAABncc3SA243.txt9.æµè§ˆå™¨æµ‹è¯•å®‰è£…elasticsearch1.è®¾ç½®max_map_countä¸èƒ½å¯åŠ¨esä¼šå¯åŠ¨ä¸èµ·æ¥æŸ¥çœ‹max_map_countçš„å€¼ é»˜è®¤æ˜¯65530cat /proc/sys/vm/max_map_count1é‡æ–°è®¾ç½®max_map_countçš„å€¼sysctl -w vm.max_map_count=2621442.ä¸‹è½½é•œåƒå¹¶è¿è¡Œ#æ‹‰å–é•œåƒdocker pull elasticsearch:7.13.2docker run -e ES_JAVA_OPTS=&quot;-Xms512m -Xmx512m&quot; -e &quot;discovery.type=single-node&quot; -d -p 9200:9200 -p 9300:9300 --restart=always --name=elastic elasticsearch:7.13.23.curl localhost:9200 æœ‰è¿”å›å³ä¸ºæˆåŠŸå®‰è£…4.å®‰è£…ä¸­æ–‡åˆ†è¯docker exec -it elastic /bin/bashå®‰è£…ESä¸­æ–‡åˆ†è¯æ’ä»¶ IK./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.13.2/elasticsearch-analysis-ik-7.13.2.zipå®‰è£…ESæ‹¼éŸ³åˆ†è¯æ’ä»¶./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-pinyin/releases/download/v7.13.2/elasticsearch-analysis-pinyin-7.13.2.zip" }, { "title": "è®°ä¸€æ¬¡å¤æ‚é¡¹ç›®è¿ç§»", "url": "/posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E8%BF%81%E7%A7%BB/", "categories": "", "tags": "è¿ç»´", "date": "2022-03-03 16:54:22 +0800", "snippet": "ç½‘ç»œç¯å¢ƒæ–°çš„æœåŠ¡å™¨ä¸è€çš„æœåŠ¡å™¨ç½‘æ®µä¸åŒï¼Œåªèƒ½å•å‘è®¿é—®è€æœåŠ¡å™¨ï¼Œä¸”æ— æ³•æœ¬åœ°è®¿é—®ï¼Œéœ€é€šè¿‡å ¡å’æœºè¿ç»´ï¼Œæ­¤ä¸ºå‰æã€‚ç¯å¢ƒå®‰è£…æ¶‰åŠåˆ°javaã€mavenåŸºæœ¬ç¯å¢ƒå®‰è£…ï¼Œmavenä¸»è¦ç”¨æ¥æ‰“åŒ…ç¨‹åºï¼Œgitæ‹‰ä¸‹æ¥æ–¹ä¾¿åœ¨çº¿éƒ¨ç½²ï¼›dockerå®‰è£…ï¼Œç”¨äºå®‰è£…ä¸€äº›ä¸­é—´ä»¶mysqlã€redisã€elasticSearchã€fastDFSã€‚å…·ä½“å®‰è£…éƒ¨ç½²ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« æ€»ç»“ã€‚æ–‡ä»¶è¿ç§»é¡¹ç›®1çš„æ–‡ä»¶å­˜å‚¨åœ¨å…¬å¸å…¬å…±çš„fastDFSåº“ï¼Œè¿ç§»æ–¹æ¡ˆä¸»è¦æœ‰æ–¹æ¡ˆ1:é‡‡ç”¨èŠ‚ç‚¹æ‰©å®¹,ç”±äºç½‘ç»œä¸é€šï¼Œæ”¾å¼ƒï¼›æ–¹æ¡ˆ2:ç›´æ¥æ‹·è´ï¼Œè®©è¿ç»´çœ‹äº†ä¸‹19Gï¼Œæ‹·å®Œä¸çŸ¥é“çŒ´å¹´é©¬æœˆäº†ï¼Œè€Œä¸”é¡¹ç›®ä¸­æ‰€å åªæœ‰1Gå·¦å³ï¼Œæ”¾å¼ƒï¼›æœ€åæƒ³äº†ä¸€ä¸ªåè·¯å­ï¼Œå†™ä»£ç è·å–åº“é‡Œçš„æ–‡ä»¶åœ°å€ï¼Œä¸‹è½½ç„¶åä¸Šä¼ åˆ°æ–°éƒ¨ç½²çš„fdfsï¼Œå†updateåº“é‡Œçš„åœ°å€ã€‚è¿‡ç¨‹æœ‰ä¸€ç‚¹æ³¢æŠ˜ï¼Œæœ‰äº›ä¸šåŠ¡è¡¨é‡Œå­˜çš„ç›´æ¥æ˜¯åœ°å€ï¼Œéœ€è¦å†æ‰¾å‡ºæ¥æ›¿æ¢æ‰ã€‚é¡¹ç›®2çš„æ–‡ä»¶å­˜å‚¨åœ¨è¿œå¤çš„ftpä¸Šï¼Œå†™äº†ä»£ç æŒ‰ç…§åœ°å€è·¯å¾„ä¸‹è½½æ‰€æœ‰æ–‡ä»¶ï¼Œç„¶ååœ¨è€æœåŠ¡å™¨ä¸Šå‹ç¼©ï¼Œå¤§å°è¾¾åˆ°9ä¸ªGï¼Œä½†æ˜¯æ–°æœåŠ¡å™¨å¯ä»¥è®¿é—®åˆ°,åˆ°åº•æ˜¯å†…ç½‘é€Ÿåº¦é£å¿«100M/sï¼Œé€šè¿‡ä»£ç çš„ä¸‹è½½æ¥å£ç›´æ¥åœ¨æ–°æœåŠ¡å™¨ä¸Šä¸‹å¥½ç„¶åè§£å‹ã€‚ä»£ç æ”¹é€ ä¸‹ï¼ŒåŸå…ˆæœ¬åœ°å¼€å‘çš„å°±æ˜¯ç›´æ¥æ–‡ä»¶å­˜å‚¨æ²¡æœ‰ä¸Šæ–‡ä»¶æœåŠ¡å™¨ï¼Œè€ä»£ç æå‡ºæ¥æ”¹æ”¹ç›´æ¥ä¸Šä¼ ä¸‹è½½é½æ´»ã€‚ä»£ç éƒ¨ç½²å‰ç«¯nginxé…ä¸‹ï¼Œåç«¯jaråŒ…å¯åŠ¨ï¼Œè°ƒæ•´ä¸‹ç«¯å£,ç„¶åç”³è¯·å¼€é€šåŸŸåæ˜ å°„ï¼Œä¸€ç³»åˆ—æ¥å£ç™½åå•ç­‰ç­‰ï¼Œé½æ´»ã€‚é—®é¢˜è§£å†³1.mysqlå¤§å°å†™é—®é¢˜ï¼Œdockeråˆ›å»ºçš„æ—¶å€™å°±è¦ç»™mysqlè®¾ç½®å¥½ã€‚2.springboot jaråŒ…å¯åŠ¨ç¼“æ…¢ï¼Œä¸€å¼€å§‹å¾ˆæ­£å¸¸ï¼Œåæ¥æ”¹è¿‡é˜²ç«å¢™ï¼Œæ¯æ¬¡éƒ½è¦2åˆ†é’Ÿå·¦å³ã€‚æ’æŸ¥ä»¥ä¸ºæ˜¯éšæœºå€¼é—®é¢˜ï¼Œä¿®æ”¹æ— æœã€‚æœ€åæ’æŸ¥åˆ°mysqlè¿æ¥è¿‡æ…¢ï¼Œå¯èƒ½æ˜¯é˜²ç«å¢™é‡å¯å¯¼è‡´dockerå®‰è£…çš„ä¸œè¥¿æœ‰é—®é¢˜ï¼Œé‡å¯dockerï¼Œé‡å¯mysqlã€‚ä»£ç å¯ä»¥æ­£å¸¸å¿«é€Ÿå¯åŠ¨å¥½ã€‚" }, { "title": "jekyllå®‰è£…chirpyä¸»é¢˜å…¨æµç¨‹", "url": "/posts/jekyll%E5%AE%89%E8%A3%85chirpy%E4%B8%BB%E9%A2%98%E5%85%A8%E6%B5%81%E7%A8%8B/", "categories": "", "tags": "åšå®¢, jekyll", "date": "2022-02-16 23:20:20 +0800", "snippet": "å®‰è£…jekyllæ­¤æ­¥éª¤ç•¥è¿‡ï¼Œç½‘ä¸Šè¾ƒå¤šï¼Œå…¨ç¨‹éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯macè‡ªå¸¦çš„rubyä¼šæœ‰é—®é¢˜ï¼Œå‡çº§ä¸‹rvmå®‰è£…é«˜ç‰ˆæœ¬rubyå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚æ­¤å¤„ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ruby 2.6.6p146 (2020-03-31 revision 67876) [x86_64-darwin21]ï¼Œåæ§½ä¸‹rubyçš„ç¯å¢ƒå®‰è£…çœŸæ˜¯ä¸€è¨€éš¾å°½ï¼ŒåŠé€€ä¸€å¤§æ³¢äººã€‚é€‰æ‹©ä¸»é¢˜æ­¤å¤„ç›´æ¥forkChirpy Starterï¼Œæ‹¿å›æ¥æ”¹æ”¹å°±å¥½ä½¿äº†ï¼Œä¸»é¢˜é£æ ¼æç®€æ·±å¾—æˆ‘å¿ƒã€‚ æ³¨æ„ç‚¹ï¼šé¡¹ç›®forkåéœ€è¦ä¿®æ”¹Gemfileçš„æºåœ°å€ï¼Œsource &quot;https://gems.ruby-china.com&quot;ï¼Œè¿™æ—¶å€™è¿è¡Œbundleä¼šå®‰è£…ç›¸å…³ä¾èµ–,è¿è¡Œjekyll så³å¯çœ‹åˆ°åˆå§‹åŒ–é¦–é¡µï¼Œ_config.ymlä¸­é…ç½®livereload: true,ç„¶åè¿è¡Œjekyll serve --force_pollingå¯ä»¥å¼€å¯å®æ—¶é¢„è§ˆã€‚åšå®¢é…ç½®åšå®¢é…ç½®ä½äº_config.ymlï¼Œä¿®æ”¹ä¸­æ–‡lang: zh-CNä»¥åŠä¸€äº›åŸºç¡€ä¿¡æ¯ï¼›é»˜è®¤ä¸ç¼–è¯‘æ—¶é—´å¤§äºå½“å‰æ—¶é—´çš„æ–‡ç« ï¼Œå¯å¢åŠ future: trueå»é™¤é™åˆ¶ã€‚é‡ç‚¹è¯´ä¸‹è¯„è®ºé…ç½®ï¼Œæœ¬äººé€‰ç”¨çš„æ˜¯giscusï¼Œåˆ©ç”¨githubè‡ªå¸¦çš„discussionè®¨è®ºåŒºåŠŸèƒ½æ¥è¿›è¡Œè¯„è®ºç®¡ç†ï¼Œä½¿ç”¨giscusæœ‰ä¸‰ä¸ªå…ˆå†³æ¡ä»¶ï¼Œå¯ä»¥å‚è€ƒgiscus-cnã€‚æŒ‰ç…§é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬åšå®¢é…ç½®æ–‡ä»¶ä¸­comments.activeåå¡«å…¥giscusï¼Œgiscusårepoå¡«çš„æ˜¯è‡ªå·±å‡†å¤‡å½“åšè¯„è®ºåŠŸèƒ½çš„repoï¼Œæ ¼å¼ç”¨æˆ·å/é¡¹ç›®åï¼Œrepo_idæ˜¯é¡¹ç›®idï¼Œcategoryæ˜¯discussionåˆ†ç±»ï¼Œcategory_idæ˜¯åˆ†ç±»idï¼Œmappingæ˜¯æ˜ å°„æ–¹å¼å¯ä»¥é€‰æ‹©å¾ˆå¤šç§ï¼Œidä¸æ¸…æ¥šå¯ä»¥æ‰“å¼€ä¸Šè¿°ç½‘å€åï¼Œè¾“å…¥ä»“åº“ç­‰ä¸€ç³»åˆ—é…ç½®åï¼Œåœ¨ä¸‹æ–¹çš„scriptè„šæœ¬ä¸­çœ‹åˆ°å¯¹åº”æ•°æ®,å®Œæˆåå³å¯åœ¨æ–‡ç« ä¸‹æ–¹çœ‹åˆ°è¯„è®ºåŒºã€‚å®‰è£…éƒ¨ç½²åŒºåˆ«äºhexoéœ€è¦ç¼–è¯‘åå†ä¸Šä¼ æ–‡ä»¶ï¼Œgithubæ”¯æŒjekyllè‡ªåŠ¨ç¼–è¯‘éƒ¨ç½²ï¼Œä¸Šä¼ ä»£ç ågithubè‡ªåŠ¨è°ƒç”¨workflowä¸­è„šæœ¬ç”Ÿæˆä¸€ä¸ªgh_pagesåˆ†æ”¯,æ­¤æ—¶åœ¨setting-pagesé‡Œé¢é€‰æ‹©åˆ†æ”¯è®¾ç½®å¥½åŸŸåå³å¯ï¼Œç›¸å…³æ•™ç¨‹å¯ä»¥æœç´¢pageséƒ¨ç½²åšå®¢,enjoy itï¼" }, { "title": "freemarker+itextå®ç°è¶…çº§ç®€å†pdf", "url": "/posts/freemarker+itext%E5%AE%9E%E7%8E%B0%E8%B6%85%E7%BA%A7%E7%AE%80%E5%8E%86pdf/", "categories": "", "tags": "", "date": "2022-01-07 17:56:18 +0800", "snippet": " æ€è·¯ï¼šå°è¯•å®ç°è¶…çº§ç®€å†çš„pdfæ ·å¼ï¼Œåˆ†ææ˜¯é€šè¿‡htmlæ¨¡æ¿ç»“åˆfreemarkerå ä½å¾ªç¯ï¼Œé…åˆitext3æ”¯æŒcss3é«˜çº§ç‰¹æ€§æ¸²æŸ“å¯Œæ–‡æœ¬ç”Ÿæˆpdfã€‚1.è®¾è®¡htmlæ¨¡æ¿ï¼Œå…³é”®è¯éƒ¨åˆ†ç”¨freemarkeræ ‡ç­¾å ä½å¤„ç†&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html lang=&quot;zh&quot;&amp;gt;&amp;lt;head&amp;gt; &amp;lt;style type=&quot;text/css&quot;&amp;gt; // æ ·å¼çœç•¥ &amp;lt;/style&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;lt;div id=&quot;head&quot; class=&quot;space&quot;&amp;gt; &amp;lt;div class=&quot;title center&quot;&amp;gt; ${username} &amp;lt;/div&amp;gt; &amp;lt;div class=&quot;center&quot;&amp;gt; ${phone} ä¸¨${email} &amp;lt;/div&amp;gt; &amp;lt;div class=&quot;center&quot;&amp;gt; ${address} &amp;lt;/div&amp;gt; &amp;lt;div class=&quot;center&quot;&amp;gt; ${homepage} &amp;lt;/div&amp;gt; &amp;lt;div class=&quot;center&quot;&amp;gt; ${birthday?string(&#39;yyyy-MM-dd&#39;)} ä¸¨${gender} &amp;lt;/div&amp;gt; &amp;lt;div class=&quot;center&quot;&amp;gt; Â ${currentJob} ä¸¨${expJob} &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;#if skill?? &amp;amp;&amp;amp;skill!=&#39;&#39;&amp;gt; &amp;lt;div class=&quot;small-title&quot;&amp;gt;ä¸“ä¸šæŠ€èƒ½&amp;lt;/div&amp;gt; &amp;lt;hr/&amp;gt; &amp;lt;div class=&quot;content space&quot;&amp;gt; ${skill} &amp;lt;/div&amp;gt;&amp;lt;/#if&amp;gt;&amp;lt;#if works?? &amp;amp;&amp;amp; (works?size &amp;gt; 0)&amp;gt; &amp;lt;div class=&quot;small-title&quot;&amp;gt;å·¥ä½œç»å†&amp;lt;/div&amp;gt; &amp;lt;hr/&amp;gt; &amp;lt;div class=&quot;content space&quot;&amp;gt; &amp;lt;#list works as t&amp;gt; &amp;lt;p class=&quot;left company&quot;&amp;gt;${t.company}&amp;lt;/p&amp;gt; &amp;lt;p class=&quot;right&quot;&amp;gt;${t.startAt} - ${t.endAt}&amp;lt;/p&amp;gt; &amp;lt;p class=&quot;clear&quot;&amp;gt;&amp;lt;/p&amp;gt; &amp;lt;p&amp;gt;${t.dept} |${t.job}&amp;lt;/p&amp;gt; ${t.description} &amp;lt;/#list&amp;gt; &amp;lt;/div&amp;gt;&amp;lt;/#if&amp;gt;&amp;lt;#if edus?? &amp;amp;&amp;amp; (edus?size &amp;gt; 0)&amp;gt; &amp;lt;div class=&quot;small-title&quot;&amp;gt;æ•™è‚²ç»å†&amp;lt;/div&amp;gt; &amp;lt;hr/&amp;gt; &amp;lt;div class=&quot;content space&quot;&amp;gt; &amp;lt;#list edus as t&amp;gt; &amp;lt;p class=&quot;left company&quot;&amp;gt;${t.university}&amp;lt;/p&amp;gt; &amp;lt;p class=&quot;right&quot;&amp;gt;${t.startAt?string(&#39;yyyy-MM&#39;)} - ${t.endAt?string(&#39;yyyy-MM&#39;)}&amp;lt;/p&amp;gt; &amp;lt;p class=&quot;clear&quot;&amp;gt;&amp;lt;/p&amp;gt; &amp;lt;p&amp;gt;${t.major} |${t.degree}&amp;lt;/p&amp;gt; ${t.description} &amp;lt;/#list&amp;gt; &amp;lt;/div&amp;gt;&amp;lt;/#if&amp;gt;&amp;lt;#if summary?? &amp;amp;&amp;amp;summary!=&#39;&#39;&amp;gt; &amp;lt;div class=&quot;small-title&quot;&amp;gt;ä¸ªäººæ€»ç»“&amp;lt;/div&amp;gt; &amp;lt;hr/&amp;gt; &amp;lt;div class=&quot;content space&quot;&amp;gt; ${summary} &amp;lt;/div&amp;gt;&amp;lt;/#if&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;2.freemarkeræ¸²æŸ“html// è·å–æ¨¡æ¿,å¹¶è®¾ç½®ç¼–ç æ–¹å¼Template template = freemarkerCfg.getTemplate(htmlTmp);template.setEncoding(&quot;UTF-8&quot;);// åˆå¹¶æ•°æ®æ¨¡å‹ä¸æ¨¡æ¿template.process(data, out); //å°†åˆå¹¶åçš„æ•°æ®å’Œæ¨¡æ¿å†™å…¥åˆ°æµä¸­ï¼Œè¿™é‡Œä½¿ç”¨çš„å­—ç¬¦æµout.flush();createPdf(out.toString(),outputStream);3.itextç”Ÿæˆpdf//css3é«˜çº§ç‰¹æ€§æ”¯æŒITextRenderer render = new ITextRenderer();ITextFontResolver fontResolver = render.getFontResolver();fontResolver.addFont(FONT, BaseFont.IDENTITY_H, BaseFont.EMBEDDED);// è§£æhtmlç”Ÿæˆpdfrender.setDocumentFromString(content);render.layout();render.createPDF(outputStream);4.å‰ç«¯æ¥æ”¶æ–‡ä»¶æµå±•ç¤ºresponse.setHeader(&quot;Content-Type&quot;, &quot;application/pdf &quot;);response.setContentType(&quot;application/pdf ;charset=utf-8&quot;);//ä¸åŠ ğŸ‘‡å°±ç›´æ¥é¢„è§ˆresponse.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=&quot; + URLEncoder.encode(&quot;test.pdf&quot;, &quot;UTF-8&quot;));æˆ‘è¿™é‡Œæ˜¯é€šè¿‡å°ç¨‹åºå±•ç¤º" }, { "title": "freemarkerå¯¼å‡ºå¯Œæ–‡æœ¬åˆ°word", "url": "/posts/freemarker%E5%AF%BC%E5%87%BA%E5%AF%8C%E6%96%87%E6%9C%AC%E5%88%B0word/", "categories": "", "tags": "java", "date": "2021-04-30 00:03:55 +0800", "snippet": " åœºæ™¯ï¼šå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­çš„æ–‡æœ¬ä¿¡æ¯å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œä¸ºhtmlè¯­è¨€ï¼Œéœ€è¦æŠŠå¯Œæ–‡æœ¬è§£æç„¶åå¯¼å‡ºåˆ°wordä¸­ã€‚ç”±äºä¸å­˜åœ¨å›¾ç‰‡ä¿¡æ¯ï¼Œæ•…æ­¤æ–‡ä¸åšè®¨è®ºã€‚å°è¯•æ–¹æ³• ä½¿ç”¨easy-poiå¯¼å‡ºwordï¼Œå•ä¸ªå­—æ®µæ–¹ä¾¿å±•ç¤ºï¼Œä½†æ˜¯å¯Œæ–‡æœ¬ä¿¡æ¯æ— æ³•è§£æï¼Œlistç±»å‹æ•°æ®éœ€è¦è§£æä¹Ÿæ²¡æœ‰è‰¯å¥½çš„è§£å†³æ–¹æ³•ï¼Œå°½ç®¡æœ‰éå†ï¼Œä½†æ˜¯ä»…é™äºè¡¨æ ¼ä¹‹ä¸­ã€‚å½’æ ¹ç»“åº•æ˜¯ç”±äºpoiå¯¹äºwordçš„æ”¯æŒä¸å¤ªè¡Œã€‚ ä½¿ç”¨freemarkeræ ‡ç­¾å ä½wordå¯¹åº”ä½ç½®ï¼Œç„¶åå¦å­˜ä¸ºmhtæ ¼å¼ï¼Œç±»ä¼¼htmlçš„ä¸€ç§æ–‡ä»¶æ ¼å¼ã€‚æ€è·¯è§£æ ç¼–è¾‘wordæ¨¡æ¿ï¼Œfreemarkeræ ‡ç­¾å ä½ ideaä¸­æ‰“å¼€å¯¹åº”æ–‡ä»¶ï¼Œå¦å­˜ä¹‹åä¼šäº§ç”Ÿæ ¼å¼é”™ä¹±ï¼Œéœ€è¦ä¿®æ”¹å ä½ç¬¦å·æ­£ç¡®ï¼Œæœ€åå¦å­˜ä¸ºftlæ ¼å¼ã€‚ ï¼ˆé‡è¦ï¼‰è§£æéœ€è¦å±•ç¤ºçš„æ–‡æœ¬ä¸º3Dus-asciç¼–ç å€¼ï¼Œä½¿ç”¨freemarkeræ¸²æŸ“æ¨¡æ¿ã€‚æ ¸å¿ƒè½¬æ¢ï¼Œå°†å¯¹è±¡ä¸­æ‰€æœ‰å­—ç¬¦æ¢æˆ3Dus-asciï¼Œåè¿›åˆ¶Accsiiç ï¼Œmhtå¯ä»¥è¯†åˆ«è½¬æ¢ä¸ºhtmlæ ¼å¼public static String string2Ascii(String source){ if(source==null || source==&quot;&quot;){ return null; } StringBuilder sb=new StringBuilder(); char[] c=source.toCharArray(); for(char item : c){ String itemascii=&quot;&quot;; if(item&amp;gt;=19968 &amp;amp;&amp;amp; item&amp;lt;40623){ itemascii=itemascii=&quot;&amp;amp;#&quot;+(item &amp;amp; 0xffff)+&quot;;&quot;; }else{ itemascii=item+&quot;&quot;; } sb.append(itemascii); } return sb.toString(); }å‚è€ƒæ–‡æ¡£chaofanHb/ExpordWord javaå¡«å……wordæ–‡æ¡£ï¼ˆå¸¦æœ‰å¯Œæ–‡æœ¬ï¼‰" }, { "title": "ç»è‰²", "url": "/posts/%E7%BB%9D%E8%89%B2/", "categories": "", "tags": "ç”Ÿæ´»éšç¬”", "date": "2020-01-09 19:13:07 +0800", "snippet": "æ˜¯çš„ï¼Œ2020çš„ç¬¬ä¸€åœºé›ªæ¥äº†ï¼Œä¾ç„¶æ¯”ä»¥å¾€ç¨æ™šä¸€äº›ï¼Œè·ç¦»2012å¹´åˆ€éƒçš„é‚£é¦–æ­Œå·²ç»è¿‡å»äº†18å¹´è‹¥é€¢æ–°é›ªåˆéœæ»¡æœˆå½“ç©ºä¸‹é¢å¹³é“ºç€çš“å½±ä¸Šé¢æµè½¬ç€äº®é“¶è€Œä½ å¸¦ç¬‘åœ°å‘æˆ‘æ­¥æ¥æœˆè‰²ä¸é›ªè‰²ä¹‹é—´ä½ æ˜¯ç¬¬ä¸‰ç§ç»è‰²" }, { "title": "Transmitç”¨iterm2æ›¿ä»£ç»ˆç«¯", "url": "/posts/Transmit%E7%94%A8iterm2%E6%9B%BF%E4%BB%A3%E7%BB%88%E7%AB%AF/", "categories": "", "tags": "mac, transmit, iterm2, ç»ˆç«¯", "date": "2019-12-23 23:43:53 +0800", "snippet": " macä¸‹sftpå·¥å…·transmitè‡ªå¸¦æ‰“å¼€terminalé‡‡ç”¨çš„æ˜¯é»˜è®¤ï¼Œæƒ³è¦æ›¿æ¢æˆiterm2 é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶éšä¾¿ä»€ä¹ˆåå­— ,ä¾‹å¦‚ transmit-iterm-patch.applescriptï¼Œä¿å­˜ä»£ç å¦‚ä¸‹ å‘½ä»¤è¡Œè¿è¡Œ defaults write com.panic.Transmit OpenTerminalScriptPath ~/transmit-iterm-patch.applescript,++æ³¨æ„åœ°å€ä¸€å®šè¦å†™å¯¹++ ç”¨transmitä¸­çš„æ‰“å¼€ç»ˆç«¯å³å¯æ‰“å¼€iterm2çš„ç•Œé¢-- Run the following cmd to make Transmit marry iterm2 as its Terminal partner:-- defaults write com.panic.Transmit OpenTerminalScriptPath ~/transmit-iterm-patch.applescripton openTerminal(location, remoteHost, serverPort) -- Prepare sshCmd and cmd: set sshCmd to &quot;&quot; set cmd to &quot;cd \\&quot;&quot; &amp;amp; location &amp;amp; &quot;\\&quot;&quot; if ((count of remoteHost) is greater than 0) then set sshCmd to &quot;ssh &quot; &amp;amp; remoteHost if (serverPort is greater than 0) then set sshCmd to sshCmd &amp;amp; &quot; -p &quot; &amp;amp; serverPort end if end if -- Check whether the application was open already. tell application &quot;System Events&quot; set wasOpen to (exists (processes where name is &quot;iTerm&quot;)) or (exists (processes where name is &quot;iTerm2&quot;)) end tell -- Do operations on iTerm. tell application &quot;iTerm&quot; activate -- Create window: if (count of windows) is 0 then create window with default profile else if wasOpen then tell first window to create tab with default profile end if end if -- Inside iterm2&#39;s window: tell first window if ((count of sshCmd) is greater than 0) then tell current session to write text sshCmd delay 0.5 end if tell current session to write text cmd end tell end tellend openTerminalå‚è€ƒæ–‡æ¡£ç»ˆç«¯æ›¿æ¢æ”»ç•¥è„šæœ¬ä»£ç githubåœ°å€" }, { "title": "onos&amp;mininetåŸºäºSDNæ¨¡æ‹Ÿip+å…‰å®‰è£…æŒ‡åŒ—", "url": "/posts/onos-mininet%E5%9F%BA%E4%BA%8ESDN%E6%A8%A1%E6%8B%9Fip-%E5%85%89%E5%AE%89%E8%A3%85%E6%8C%87%E5%8C%97/", "categories": "", "tags": "onos, mininet", "date": "2019-05-20 18:39:58 +0800", "snippet": " onos mininet çœŸæŒºå‘çš„ï¼Œå›½å†…ç ”ç©¶äººå¾ˆå°‘ï¼Œç›¸å…³æ–‡æ¡£åŸºæœ¬é å¢™å¤–ï¼Œè®°å½•ä¸‹è¿‡ç¨‹å§1.onoså®‰è£… åŸºäº1.9.0å®‰è£…onos onos githubä¸‹è½½æºç ï¼Œåˆ‡æ¢1.9.0åˆ†æ”¯ è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¿®æ”¹ tools/dev/bash_profile ä¸­å„é¡¹é…ç½®ï¼Œç³»ç»Ÿå˜é‡.profileä¸­åŠ å…¥å¦‚ä¸‹ source ~/documents/work/onos/tools/dev/bash_profile #åˆšåˆšä¸‹è½½onosç›®å½•export ONOS_APPS=&quot;drivers,drivers.optical,openflow,proxyarp,optical,onos-jsptpd-sdn&quot; #onos-jsptpd-sdnä¸ºå¦å¤–å¼€å‘appexport PATH=&quot;$PATH:$HOME/bin&quot; é¡¹ç›®ç›®å½•ä¸­è¿è¡Œ ok ,æ­¤æ—¶ä¼šä¸‹è½½buckå¹¶æ‰“åŒ…è¿è¡Œé¡¹ç›®ï¼Œä¼šæ¯”è¾ƒæ…¢ï¼Œä¸€å®šè¦æŒ‚æ¢¯å­ opæ‰“åŒ…å‘½ä»¤ï¼Œok clean debugä¼šå¼€å¯è¿œç¨‹ç«¯å£ï¼Œé…åˆideaå¯ä»¥å®ç°è°ƒè¯•2.mininetå®‰è£… onos å®˜ç½‘æ•™ç¨‹cdgit clone git://github.com/mininet/mininetcd mininetwget &#39;https://wiki.onosproject.org/download/attachments/4164175/multi_controller.patch?version=1&amp;amp;modificationDate=1443649770762&amp;amp;api=v2&#39; -O multi_controller.patchgit apply multi_controller.patchsudo ./util/install.sh -3fnv# role back CPqD to a version known to workcdcd ~/ofsoftswitch13/make cleangit reset --hard 8d3df820f7487f541b3f5862081a939aad76d8b5sudo make installcdsudo mn --test pingall # this should work3.linc-oeå®‰è£… æ¨¡æ‹Ÿå…‰ç½‘ç»œcdgit clone git://github.com/mininet/mininetcd mininetwget &#39;https://wiki.onosproject.org/download/attachments/4164175/multi_controller.patch?version=1&amp;amp;modificationDate=1443649770762&amp;amp;api=v2&#39; -O multi_controller.patchgit apply multi_controller.patchsudo ./util/install.sh -3fnv# role back CPqD to a version known to workcdcd ~/ofsoftswitch13/make cleangit reset --hard 8d3df820f7487f541b3f5862081a939aad76d8b5sudo make installcdsudo mn --test pingall # this should work4.æ–°å»ºæ‹“æ‰‘æ¨é€åˆ°onos mininetå®‰è£…è¡¥ä¸åå¯ä»¥æ¨é€å¤šä¸ªonosä¸»æœºï¼Œå®ç°é›†ç¾¤ sudo -E python onos/tools/test/topos/opticalTestBig.py $OC1 $OC2 $OC3 5.å®ç°restæ¥å£æ“ä½œmininetgithubä¸Šæ‰¾åˆ°ä¸€ä¸ªé¡¹ç›® mininetrestï¼ŒäºŒæ¬¡å¼€å‘äº†ä¸‹ï¼Œå®ç°æ“ä½œlinkï¼Œå¯åŠ¨mininetçš„æ—¶å€™ä¼šå¯åŠ¨ä¸€ä¸ªwebæœåŠ¡å™¨ç›‘å¬è¯·æ±‚æ“ä½œmininetå‚è€ƒæ–‡æ¡£ä½¿ç”¨buckå®‰è£…ONOSonos ip+å…‰ç¯å¢ƒé…ç½®" }, { "title": "java8ç‰¹æ€§å­¦ä¹ 1ï¼šLamdaè¡¨è¾¾å¼", "url": "/posts/java8%E7%89%B9%E6%80%A7%E5%AD%A6%E4%B9%A01-Lamda%E8%A1%A8%E8%BE%BE%E5%BC%8F/", "categories": "", "tags": "java", "date": "2019-05-10 17:53:27 +0800", "snippet": " è¯­è¨€åœ¨è¿›æ­¥ï¼Œäººä¹Ÿè¦è¿›æ­¥ç®€ä»‹Lamdaè¡¨è¾¾å¼ï¼Œè¯»ä½œÎ»è¡¨è¾¾å¼ï¼ŒLambdaï¼ˆå¤§å†™Î›ï¼Œå°å†™Î»ï¼‰è¯»éŸ³ï¼šlam (b) daï¼ˆå…°æœ¨è¾¾ï¼‰[â€˜lÃ¦mdÉ™]å®ƒå®è´¨å±äºå‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µï¼Œè¦ç†è§£å‡½æ•°å¼ç¼–ç¨‹çš„äº§ç”Ÿç›®çš„ï¼Œå°±è¦å…ˆç†è§£åŒ¿åå†…éƒ¨ç±»ã€‚å‡½æ•°å¼æ¥å£(Functional Interface)å°±æ˜¯ä¸€ä¸ªæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªéæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚å‡½æ•°å¼æ¥å£å¯ä»¥è¢«éšå¼è½¬æ¢ä¸º lambda è¡¨è¾¾å¼ã€‚Lambda è¡¨è¾¾å¼å’Œæ–¹æ³•å¼•ç”¨ï¼ˆå®é™…ä¸Šä¹Ÿå¯è®¤ä¸ºæ˜¯Lambdaè¡¨è¾¾å¼ï¼‰ä¸Šã€‚å¦‚å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°å¼æ¥å£å¦‚ä¸‹ï¼š@FunctionalInterfaceinterface GreetingService { void sayMessage(String message);}é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼æ¥è¡¨ç¤ºè¯¥æ¥å£çš„ä¸€ä¸ªå®ç°(æ³¨ï¼šJAVA 8 ä¹‹å‰ä¸€èˆ¬æ˜¯ç”¨åŒ¿åç±»å®ç°çš„)ï¼šGreetingService greetService1 = message -&amp;gt; System.out.println(&quot;Hello &quot; + message);Lamdaè¯­æ³•æœ‰ä¸‰ç§å½¢å¼ï¼š (å‚æ•°) -&amp;gt;å•è¡Œè¯­å¥ï¼› (å‚æ•°) -&amp;gt;{å¤šè¡Œè¯­å¥}ï¼› (å‚æ•°) -&amp;gt;è¡¨è¾¾å¼ï¼›æ‹¬å·ï¼ˆï¼‰å¯ä»¥å¤§è‡´ç†è§£ä¸ºå°±æ˜¯æ–¹æ³•ï¼Œé‡Œé¢æ˜¯å‚æ•°å˜é‡ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­()-&amp;gt;System.out.println(â€œHello World!â€) å‰é¢çš„()ä»£è¡¨void å®ƒæ²¡æœ‰å…¥å‚ï¼Œæ‰€ä»¥ä¸ºç©ºï¼Œ-&amp;gt;åé¢æ˜¯ä¸€ä¸ªå•è¡Œè¯­å¥ï¼›å¦‚æœ-&amp;gt;åé¢æ˜¯å¤šè¡Œè¯­å¥ï¼Œéœ€è¦ç”¨{ }è£…èµ·æ¥ï¼Œæ¯æ¡è¯­å¥åéœ€è¦æœ‰åˆ†å·;-&amp;gt;åé¢ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¦‚ï¼ša+bç­‰ã€‚ lambdaå†™çš„å¥½å¯ä»¥æå¤§çš„å‡å°‘ä»£ç å†—ä½™ï¼ŒåŒæ—¶å¯è¯»æ€§ä¹Ÿå¥½è¿‡å†—é•¿çš„å†…éƒ¨ç±»ï¼ŒåŒ¿åç±»new Thread(new Runnable() { @Override public void run() { System.out.println(&quot;çº¿ç¨‹æ“ä½œï¼&quot;); }});ã€€ã€€ç°åœ¨ï¼Œä½¿ç”¨Lamdaè¡¨è¾¾å¼ï¼Œç®€å•å†™ä¸ºï¼šnew Thread(()-&amp;gt;System.out.println(&quot;çº¿ç¨‹æ“ä½œï¼&quot;));å˜é‡lambdaè¡¨è¾¾å¼å¯ä»¥è®¿é—®ç»™å®ƒä¼ é€’çš„å˜é‡ï¼Œè®¿é—®è‡ªå·±å†…éƒ¨å®šä¹‰çš„å˜é‡ï¼ŒåŒæ—¶ä¹Ÿèƒ½è®¿é—®å®ƒå¤–éƒ¨çš„å˜é‡ã€‚ä¸è¿‡lambdaè¡¨è¾¾å¼è®¿é—®å¤–éƒ¨å˜é‡æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„é™åˆ¶ï¼šå˜é‡ä¸å¯å˜ï¼ˆåªæ˜¯å¼•ç”¨ä¸å¯å˜ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„ä¸å¯å˜ï¼‰ã€‚ç”±äºæ˜¯å®ç°åŒ¿åå†…éƒ¨ç±»æ•ˆæœï¼Œå¼•ç”¨çš„å¤–éƒ¨å˜é‡éœ€è¦æ—¶finalï¼Œç°åœ¨java8å¯¹è¿™ä¸ªé™åˆ¶åšäº†ä¼˜åŒ–ï¼Œå¯ä»¥ä¸ç”¨æ˜¾ç¤ºä½¿ç”¨finalä¿®é¥°ï¼Œä½†æ˜¯ç¼–è¯‘å™¨éšå¼å½“æˆfinalæ¥å¤„ç†ã€‚åœ¨lambdaä¸­ï¼Œthisä¸æ˜¯æŒ‡å‘lambdaè¡¨è¾¾å¼äº§ç”Ÿçš„é‚£ä¸ªSAMå¯¹è±¡ï¼Œè€Œæ˜¯å£°æ˜å®ƒçš„å¤–éƒ¨å¯¹è±¡ã€‚æ–¹æ³•å¼•ç”¨&amp;amp;æ„é€ å™¨å¼•ç”¨ objectName::instanceMethodä¾‹å¦‚ System.out::printlnç­‰åŒäºx-&amp;gt;System.out.println(x)ï¼› ClassName::staticMethodä¾‹å¦‚ Math::maxç­‰åŒäº(x, y)-&amp;gt;Math.max(x,y) ClassName::instanceMethodä¾‹å¦‚ String::toUpperCaseç­‰äºx-&amp;gt;x.toUpperCase() ClassName::new æ„é€ å™¨å¼•ç”¨ä¾‹å¦‚ BigDecimal::newç­‰åŒäºx-&amp;gt;new BigDecimal(x)ã€‚Stream Java 8 APIæ·»åŠ äº†ä¸€ä¸ªæ–°çš„æŠ½è±¡ç§°ä¸ºæµStreamï¼Œå¯ä»¥è®©ä½ ä»¥ä¸€ç§å£°æ˜çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚ Stream ä½¿ç”¨ä¸€ç§ç±»ä¼¼ç”¨ SQL è¯­å¥ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„ç›´è§‚æ–¹å¼æ¥æä¾›ä¸€ç§å¯¹ Java é›†åˆè¿ç®—å’Œè¡¨è¾¾çš„é«˜é˜¶æŠ½è±¡ã€‚ Stream APIå¯ä»¥æå¤§æé«˜Javaç¨‹åºå‘˜çš„ç”Ÿäº§åŠ›ï¼Œè®©ç¨‹åºå‘˜å†™å‡ºé«˜æ•ˆç‡ã€å¹²å‡€ã€ç®€æ´çš„ä»£ç ã€‚ è¿™ç§é£æ ¼å°†è¦å¤„ç†çš„å…ƒç´ é›†åˆçœ‹ä½œä¸€ç§æµï¼Œ æµåœ¨ç®¡é“ä¸­ä¼ è¾“ï¼Œ å¹¶ä¸”å¯ä»¥åœ¨ç®¡é“çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå¤„ç†ï¼Œ æ¯”å¦‚ç­›é€‰ï¼Œ æ’åºï¼Œèšåˆç­‰ã€‚ å…ƒç´ æµåœ¨ç®¡é“ä¸­ç»è¿‡ä¸­é—´æ“ä½œï¼ˆintermediate operationï¼‰çš„å¤„ç†ï¼Œæœ€åç”±æœ€ç»ˆæ“ä½œ(terminal operation)å¾—åˆ°å‰é¢å¤„ç†çš„ç»“æœã€‚Collectionæ¥å£æœ‰ä¸€ä¸ªstreamæ–¹æ³•ï¼Œæ‰€ä»¥å…¶æ‰€æœ‰å­ç±»éƒ½éƒ½å¯ä»¥è·å–å¯¹åº”çš„Streamå¯¹è±¡ã€‚public interface Collection&amp;lt;E&amp;gt; extends Iterable&amp;lt;E&amp;gt; { //å…¶ä»–æ–¹æ³•çœç•¥ default Stream&amp;lt;E&amp;gt; stream() { return StreamSupport.stream(spliterator(), false); }}+--------------------+ +------+ +------+ +---+ +-------+| stream of elements +-----&amp;gt; |filter+-&amp;gt; |sorted+-&amp;gt; |map+-&amp;gt; |collect|+--------------------+ +------+ +------+ +---+ +-------+forEachStream æä¾›äº†æ–°çš„æ–¹æ³• â€˜forEachâ€™ æ¥è¿­ä»£æµä¸­çš„æ¯ä¸ªæ•°æ®ã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ forEach è¾“å‡ºäº†10ä¸ªéšæœºæ•°ï¼šRandom random = new Random();random.ints().limit(10).forEach(System.out::println);mapmap æ–¹æ³•ç”¨äºæ˜ å°„æ¯ä¸ªå…ƒç´ åˆ°å¯¹åº”çš„ç»“æœï¼Œä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ map è¾“å‡ºäº†å…ƒç´ å¯¹åº”çš„å¹³æ–¹æ•°ï¼šList&amp;lt;Integer&amp;gt; numbers = Arrays.asList(3, 2, 2, 3, 7, 3, 5);// è·å–å¯¹åº”çš„å¹³æ–¹æ•°List&amp;lt;Integer&amp;gt; squaresList = numbers.stream().map( i -&amp;gt; i*i).distinct().collect(Collectors.toList()); mapå’ŒforeachåŒºåˆ«åœ¨äºmapæ˜¯1ï¼š1æ˜ å°„ï¼Œforeachä¸­åˆ™å¯ä»¥è¿›è¡Œæ“ä½œè¾“å‡ºfilterfilter æ–¹æ³•ç”¨äºé€šè¿‡è®¾ç½®çš„æ¡ä»¶è¿‡æ»¤å‡ºå…ƒç´ ã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ filter æ–¹æ³•è¿‡æ»¤å‡ºç©ºå­—ç¬¦ä¸²ï¼šList&amp;lt;String&amp;gt;strings = Arrays.asList(&quot;abc&quot;, &quot;&quot;, &quot;bc&quot;, &quot;efg&quot;, &quot;abcd&quot;,&quot;&quot;, &quot;jkl&quot;);// è·å–ç©ºå­—ç¬¦ä¸²çš„æ•°é‡int count = strings.stream().filter(string -&amp;gt; string.isEmpty()).count();limitlimit æ–¹æ³•ç”¨äºè·å–æŒ‡å®šæ•°é‡çš„æµã€‚ ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ limit æ–¹æ³•æ‰“å°å‡º 10 æ¡æ•°æ®ï¼šRandom random = new Random();random.ints().limit(10).forEach(System.out::println);sortedsorted æ–¹æ³•ç”¨äºå¯¹æµè¿›è¡Œæ’åºã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µä½¿ç”¨ sorted æ–¹æ³•å¯¹è¾“å‡ºçš„ 10 ä¸ªéšæœºæ•°è¿›è¡Œæ’åºï¼šRandom random = new Random();random.ints().limit(10).sorted().forEach(System.out::println);å¹¶è¡Œï¼ˆparallelï¼‰ç¨‹åºparallelStream æ˜¯æµå¹¶è¡Œå¤„ç†ç¨‹åºçš„ä»£æ›¿æ–¹æ³•ã€‚ä»¥ä¸‹å®ä¾‹æˆ‘ä»¬ä½¿ç”¨ parallelStream æ¥è¾“å‡ºç©ºå­—ç¬¦ä¸²çš„æ•°é‡ï¼šList&amp;lt;String&amp;gt; strings = Arrays.asList(&quot;abc&quot;, &quot;&quot;, &quot;bc&quot;, &quot;efg&quot;, &quot;abcd&quot;,&quot;&quot;, &quot;jkl&quot;);// è·å–ç©ºå­—ç¬¦ä¸²çš„æ•°é‡int count = strings.parallelStream().filter(string -&amp;gt; string.isEmpty()).count();æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨é¡ºåºè¿è¡Œå’Œå¹¶è¡Œç›´æ¥åˆ‡æ¢ã€‚CollectorsCollectors ç±»å®ç°äº†å¾ˆå¤šå½’çº¦æ“ä½œï¼Œä¾‹å¦‚å°†æµè½¬æ¢æˆé›†åˆå’Œèšåˆå…ƒç´ ã€‚Collectors å¯ç”¨äºè¿”å›åˆ—è¡¨æˆ–å­—ç¬¦ä¸²ï¼šList&amp;lt;String&amp;gt;strings = Arrays.asList(&quot;abc&quot;, &quot;&quot;, &quot;bc&quot;, &quot;efg&quot;, &quot;abcd&quot;,&quot;&quot;, &quot;jkl&quot;);List&amp;lt;String&amp;gt; filtered = strings.stream().filter(string -&amp;gt; !string.isEmpty()).collect(Collectors.toList()); System.out.println(&quot;ç­›é€‰åˆ—è¡¨: &quot; + filtered);String mergedString = strings.stream().filter(string -&amp;gt; !string.isEmpty()).collect(Collectors.joining(&quot;, &quot;));System.out.println(&quot;åˆå¹¶å­—ç¬¦ä¸²: &quot; + mergedString);ç»Ÿè®¡å¦å¤–ï¼Œä¸€äº›äº§ç”Ÿç»Ÿè®¡ç»“æœçš„æ”¶é›†å™¨ä¹Ÿéå¸¸æœ‰ç”¨ã€‚å®ƒä»¬ä¸»è¦ç”¨äºintã€doubleã€longç­‰åŸºæœ¬ç±»å‹ä¸Šï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥äº§ç”Ÿç±»ä¼¼å¦‚ä¸‹çš„ç»Ÿè®¡ç»“æœã€‚List&amp;lt;Integer&amp;gt; numbers = Arrays.asList(3, 2, 2, 3, 7, 3, 5); IntSummaryStatistics stats = numbers.stream().mapToInt((x) -&amp;gt; x).summaryStatistics(); System.out.println(&quot;åˆ—è¡¨ä¸­æœ€å¤§çš„æ•° : &quot; + stats.getMax());System.out.println(&quot;åˆ—è¡¨ä¸­æœ€å°çš„æ•° : &quot; + stats.getMin());System.out.println(&quot;æ‰€æœ‰æ•°ä¹‹å’Œ : &quot; + stats.getSum());System.out.println(&quot;å¹³å‡æ•° : &quot; + stats.getAverage());" }, { "title": "ä¸ªäººåšå®¢å¼€å¯https", "url": "/posts/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%BC%80%E5%90%AFhttps/", "categories": "", "tags": "", "date": "2019-02-22 18:51:29 +0800", "snippet": " hexoæ­å»ºçš„åšå®¢ï¼ŒåŸŸånamecheapæ‰˜ç®¡ï¼Œå†…å®¹æ”¾åœ¨github pagesï¼Œæƒ³è¦å¼€å¯https cloudflareæä¾›å…è´¹çš„sslæœåŠ¡ï¼ŒdnsåŠ é€Ÿç­‰åŠŸèƒ½ï¼Œæ³¨å†Œé€‰æ‹©å…è´¹æœåŠ¡ï¼Œæ·»åŠ åšå®¢åŸŸåï¼Œæ‰«ædnsåcontinueï¼Œè·å¾—ä¸¤ä¸ªdnsåœ°å€ã€‚ ç™»é™†namecheapï¼Œè‡ªå®šä¹‰dnså¡«å…¥. è®¾ç½®cloudflareâ€“CryptoåŠ å¯†é€‰é¡¹ä¸ºflexible,æ²¡æœ‰è¯ä¹¦çš„æƒ…å†µä¸‹é€‰æ‹©è¿™ä¸ªï¼Œè‡ªå·±ä¸éœ€è¦è¯ä¹¦.æŠŠä¸‹é¢httpsé‡å®šå‘çš„å…¨éƒ¨å¼€å¯ã€‚â€”Page Rulesè®¾ç½®https301é‡å®šå‘https æ£€æŸ¥ç½‘é¡µèµ„æºä¸­ä¸å¾—å¼•ç”¨httpèµ„æºï¼Œå¦åˆ™httpsæˆåŠŸä½†æ˜¯ä¸æ˜¾ç¤ºç»¿é”ã€‚" }, { "title": "JavaMailæ’é›·æŒ‡å—", "url": "/posts/JavaMail%E6%8E%92%E9%9B%B7%E6%8C%87%E5%8D%97/", "categories": "", "tags": "java", "date": "2018-12-21 16:55:48 +0800", "snippet": " æœ‰éœ€æ±‚åœ¨ç”¨æˆ·ä¸‹å•åå‘é€æé†’é‚®ä»¶ç»™å®¢æœé‚®ç®±ï¼Œå®ç°äº†ä¸€ä¸‹å‘ç°å…¶ä¸­è¿˜æ˜¯è›®å¤šæ³¨æ„äº‹é¡¹å‡†å¤‡äº‹é¡¹ è¦å‘é‚®ä»¶è‚¯å®šéœ€è¦ä¸€ä¸ªç”¨æ¥å‘ä»¶é‚®ç®±ï¼Œç™¾åº¦å¤§æ³•è¯´éœ€è¦ä¸€ä¸ªå¼€é€šæ—¶é—´æ¯”è¾ƒä¹…çš„é‚®ç®±ï¼Œå› ä¸ºè‡ªå·±ç”¨çš„å°±æ˜¯ä¸€å¹´å‰å¼€é€šçš„é‚®ç®±å°±æ²¡å»éªŒè¯ã€‚ ç”¨çš„163é‚®ç®±ï¼Œå¼€é€šæˆæƒç ï¼Œæœ€é‡è¦å¼€å¯smtpæœåŠ¡ï¼Œç”¨æ¥å‘é€é‚®ä»¶ è‡³æ­¤ï¼Œé‚®ç®±å‡†å¤‡å·¥ä½œè¿›è¡Œå®Œæ¯• å¼€å‘å·¥ä½œ å¼•å…¥mavenä»“åº“ &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;javax.mail&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;mail&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;1.4.7&amp;lt;/version&amp;gt; &amp;lt;/dependency&amp;gt; 2.ç¼–å†™ä»£ç -javamailé…ç½® smtpæœåŠ¡ 25æ˜¯æ­£å¸¸ç«¯å£ 465æ˜¯sslç«¯å£ï¼Œç”±äºé˜¿é‡Œäº‘å‡ºäºå®‰å…¨å› ç´ ç¦æ‰äº†25ç«¯å£ï¼Œåªèƒ½é‡‡ç”¨465ç«¯å£static { props = new Properties(); props.setProperty(&quot;mail.transport.protocol&quot;, PROTOCOL); props.setProperty(&quot;mail.smtp.host&quot;, HOST); props.put(&quot;mail.smtp.socketFactory.class&quot;, &quot;javax.net.ssl.SSLSocketFactory&quot;); props.put(&quot;mail.smtp.socketFactory.port&quot;, &quot;465&quot;); //ssl props.put(&quot;mail.smtp.port&quot;, &quot;465&quot;); // ssl props.setProperty(&quot;mail.smtp.auth&quot;, IS_AUTH); props.setProperty(&quot;mail.debug&quot;, IS_ENABLED_DEBUG_MOD); }3.ç¼–å†™ä»£ç -javamailå‘é€ æ³¨æ„ç‚¹ æœ¬æœºç¯å¢ƒä¸linuxç¯å¢ƒç¼–ç ä¸åŒï¼Œå¦‚æœå¯¹æ ‡é¢˜æ­£æ–‡ä¸è¿›è¡Œè½¬ç ï¼Œä¸­æ–‡ä¼šä¹±ç /** * é˜²æ­¢ä¸­æ–‡ä¹±ç  * @param text * @return */ private static String transcode(String text){ try { return MimeUtility.encodeText(text,MimeUtility.mimeCharset(&quot;gb2312&quot;), null); } catch (UnsupportedEncodingException e) { e.printStackTrace(); return null; } } /** * å‘é€ç®€å•çš„æ–‡æœ¬é‚®ä»¶ */ public static boolean sendTextEmail(String to, String content) throws Exception { try { // åˆ›å»ºSessionå®ä¾‹å¯¹è±¡ Session session1 = Session.getDefaultInstance(props); // åˆ›å»ºMimeMessageå®ä¾‹å¯¹è±¡ MimeMessage message = new MimeMessage(session1); // è®¾ç½®å‘ä»¶äºº message.setFrom(new InternetAddress(from)); // è®¾ç½®é‚®ä»¶ä¸»é¢˜ String mail_subject = &quot;æ‚¨æœ‰æ–°çš„è®¢å•ã€&quot;+ DateUtils.formatToSS(new Date())+&quot;ã€‘&quot;; message.setSubject(transcode(mail_subject)); // è®¾ç½®æ”¶ä»¶äºº message.setRecipient(RecipientType.TO, new InternetAddress(to)); String nick= transcode(&quot;æ±ŸåŒ—å¥½é˜¿å§¨&quot;); message.setFrom(new InternetAddress(nick+&quot; &amp;lt;&quot;+from+&quot;&amp;gt;&quot;)); // è®¾ç½®å‘é€æ—¶é—´ message.setSentDate(new Date()); // è®¾ç½®çº¯æ–‡æœ¬å†…å®¹ä¸ºé‚®ä»¶æ­£æ–‡ message.setContent(content, &quot;text/plain;charset=utf-8&quot;); //ç”Ÿæˆé‚®ä»¶æ­£æ–‡ // ä¿å­˜å¹¶ç”Ÿæˆæœ€ç»ˆçš„é‚®ä»¶å†…å®¹ message.saveChanges(); // è·å¾—Transportå®ä¾‹å¯¹è±¡ Transport transport = session1.getTransport(); // æ‰“å¼€è¿æ¥ transport.connect(uname, upass); // å°†messageå¯¹è±¡ä¼ é€’ç»™transportå¯¹è±¡ï¼Œå°†é‚®ä»¶å‘é€å‡ºå» transport.sendMessage(message, message.getAllRecipients()); // å…³é—­è¿æ¥ transport.close(); return true; } catch (Exception e) { e.printStackTrace(); return false; } æ‰“å®Œæ”¶å·¥" }, { "title": "é˜¿é‡Œäº‘åŸŸåæ›´æ¢è¯ä¹¦", "url": "/posts/%E9%98%BF%E9%87%8C%E4%BA%91%E5%9F%9F%E5%90%8D%E6%9B%B4%E6%8D%A2%E8%AF%81%E4%B9%A6/", "categories": "", "tags": "æœåŠ¡å™¨, è¯ä¹¦", "date": "2018-12-19 21:51:47 +0800", "snippet": "ç”±äºå°ç¨‹åºéœ€è¦httpsæ¥å£ï¼Œæ‰€ä»¥å»å¹´ç”³è¯·äº†é˜¿é‡Œäº‘çš„sslå…è´¹è¯ä¹¦ï¼Œå¹´åº•å¿«åˆ°æœŸäº†ï¼Œå…è´¹ä¸èƒ½ç»­è´¹åªèƒ½é‡æ–°ç”³è¯·ä¸€ä¸ªã€‚ ä¸å¾—ä¸è¯´ï¼Œé˜¿é‡Œäº‘å…è´¹è¯ä¹¦è—å¾—çœŸå¤Ÿæ·±çš„ è´­ä¹°å…è´¹è¯ä¹¦ éªŒè¯dnsï¼ŒåŸŸåä¸‹é¢è§£æè¯ä¹¦æŒ‡å®šçš„é…ç½® ç­‰å¾…å®¡æ‰¹ ä¸‹è½½è¯ä¹¦ï¼Œæˆ‘æœåŠ¡å™¨ç”¨çš„nginxè½¬å‘æ‰€ä»¥åªè¦é…ç½®ä¸‹nginxçš„å°±å¥½äº†#å°ç¨‹åºhttpsserver { listen 443; server_name xxxx; #å¡«å†™ç»‘å®šè¯ä¹¦çš„åŸŸå ssl on; ssl_certificate cert/xxxxx; #å¡«å†™ç»‘å®šè¯ä¹¦çš„æ–‡ä»¶è·¯å¾„ pem ssl_certificate_key cert/xxxxx;#å¡«å†™ç»‘å®šè¯ä¹¦çš„æ–‡ä»¶è·¯å¾„ key ssl_session_timeout 5m; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; location / { proxy_pass http://localhost:8080; }} é‡åˆ°ä¸€ä¸ªå°å‘ï¼Œæ–°ä¹°çš„æœåŠ¡å™¨443ç«¯å£æ²¡å¼€ï¼Œå¯¼è‡´è®¿é—®ä¸äº†ï¼Œå®‰å…¨ç»„é…ç½®ä¸‹å°±å¥½äº† æ‰“å®Œæ”¶å·¥ï¼Œæ‰“å¼€æµè§ˆå™¨å¯ä»¥çœ‹åˆ°å·²ç»ç½‘ç«™å‰é¢çš„å°ç»¿é”æ‹‰ " }, { "title": "linux å¼€å¯sshæ‰å‘", "url": "/posts/linux-%E5%BC%80%E5%90%AFssh%E6%8E%89%E5%9D%91/", "categories": "", "tags": "", "date": "2018-12-04 22:36:54 +0800", "snippet": "ç™¾åº¦æœå…¶å®ƒé—®é¢˜çš„æ—¶å€™ä¸å°å¿ƒæŠŠetcçš„æƒé™æçš„å¤ªé«˜ï¼Œå¯¼è‡´sshæœåŠ¡å‡ºé—®é¢˜winscp puttyéƒ½è¿æ¥ä¸ä¸Šäº†ï¼Œè¿ç»´å°ç™½æœ€åç»ˆäºå®šä½é—®é¢˜/usr/sbin/sshd -T æŸ¥çœ‹sshå¯åŠ¨é—®é¢˜é‡æ–°ç»™æƒé™ chmod 600 -R /etc/sshdå¯åŠ¨æå®š service sshd startï¼Œé¡ºåˆ©è¿æ¥ä¸Š" }, { "title": "2018å¹´ä¸­å­¦ä¹ è®¡åˆ’", "url": "/posts/2018%E5%B9%B4%E4%B8%AD%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/", "categories": "", "tags": "", "date": "2018-07-10 21:27:03 +0800", "snippet": " 2018ä¸ŠåŠå¹´ï¼Œæœ‰æƒŠå–œæœ‰æ”¶è·ä¹Ÿæœ‰å¤±å»ä»¥åŠè½å¯ã€‚æ€»ç»“ä¸€å“ˆ å†…å®¹ï¼šå·¥ä½œç©ºä½™å­¦ä¹ äº†angularï¼Œvueï¼Œå°ç¨‹åºå¼€å‘æ¡†æ¶ï¼Œç»“åˆè‡ªå·±çš„æƒ³æ³•åšäº†å’©å’©é›†å¸‚H5ï¼ˆangularï¼‰ä»¥åŠåå°ï¼ˆvueï¼‰ï¼Œåé¢åŸºäºh5é¡¹ç›®é‡æ„äº†å’©å’©é›†å¸‚å°ç¨‹åºç«¯ï¼Œä»¥åŠç›®å‰çš„æ±ŸåŒ—å¥½é˜¿å§¨é¡¹ç›®çš„æŒç»­å¼€å‘ã€‚ æ”¶è·ï¼šå‘ç°ä¹‹å‰å†™çš„ä¸€äº›ä»£ç éƒ½å¾ˆå¤§ä¼˜åŒ–ç©ºé—´,å†™å‰ç«¯é€»è¾‘ä»£ç å¯¹äºåå°æ€ç»´ä¹Ÿæœ‰å¸®åŠ©,å…¬å¸ä¸æ˜¯å‰åç«¯åˆ†ç¦»ï¼Œä½œä¸ºjavaå¼€å‘ç»å¸¸è¦å‰ç«¯æ¥ä¸€æ‰‹ï¼Œæœ‰æ—¶å€™éƒ½æ¨è¿™æ„šè ¢çš„æ¨¡å¼ã€‚ç›®å‰æŠŠå‰åå°äº¤äº’æ‘¸å¾—ä¹Ÿç®—ä¸€æ¸…äºŒæ¥šï¼Œå‰ç«¯åˆ°åå°ï¼Œå†åˆ°å‰ç«¯æ‰“åŒ…æ‰”åˆ°nginxï¼Œåå°æ‰”åˆ°tomcatæœåŠ¡å™¨éƒ½ç®—å¾—å¿ƒåº”æ‰‹ã€‚ å±•æœ›ä¸€ä¸‹ä¸‹åŠå¹´ åå°æŠ€æœ¯é‡ç‚¹ç ”ç©¶ä¸‹å¾®æœåŠ¡ï¼ˆSpringCloudæˆ–è€…Dubboï¼‰ä»¥åŠå¯¹äºå¤šçº¿ç¨‹é«˜å¹¶å‘çš„äº†è§£ç¨‹åº¦ å‰ç«¯å­¦ä¹ ä¸‹Reactï¼Œå‘ç°è¶Šæ¥è¶Šå¤šçš„å¤§å‚éƒ½åœ¨ä½¿ç”¨Reactï¼Œç‰¹åˆ«æ˜¯é˜¿é‡Œå¯¹å…¶æƒ…æœ‰ç‹¬é’Ÿï¼Œä»Šå¤©åˆšçœ‹åˆ°äº¬ä¸œä¹Ÿå‡ºäº†ä¸€ä¸ªåŸºäºReactçš„å°ç¨‹åºæ¡†æ¶Taro ä¸Šçº¿æ±ŸåŒ—å¥½é˜¿å§¨å°ç¨‹åºï¼ŒæŒç»­è¿­ä»£ æœ€åï¼Œç”Ÿæ´»å®‰é€¸ä¸åº”è¯¥æˆä¸ºæˆ‘ä»¬åœæ»ä¸å‰çš„å€Ÿå£ã€‚ç”Ÿå‘½ä¸æ­¢ï¼Œå¥‹æ–—ä¸æ¯ï¼Œä¸å›å…±å‹‰ã€‚" }, { "title": "å°ç¨‹åºä»å…¥é—¨åˆ°æ”¾å¼ƒ ç¬¬ä¸€å›", "url": "/posts/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83-%E7%AC%AC%E4%B8%80%E5%9B%9E/", "categories": "", "tags": "å°ç¨‹åº, å…¨æ ˆ", "date": "2018-01-12 00:17:12 +0800", "snippet": " å»å¹´çš„å°ç¨‹åºåˆ°ä»Šå¤©å¤§æ”¾å¼‚å½©çš„å°æ¸¸æˆï¼Œè…¾è®¯å¯ç®—æ˜¯ç»™å°xxæ“ç¢äº†å¿ƒï¼Œä½†æ˜¯å®˜æ–¹æ–‡æ¡£çš„ä¸å…¨åˆ°å¼€å‘ç¤¾åŒºçš„å‚å·®ä¸é½ï¼Œè®©å¼€å‘è€…ä»ä¸€ä¸ªå‘çˆ¬èµ·æ¥åˆæ‰ä¸‹å¦ä¸€ä¸ªå‘ç¬¬ä¸€å› ç‹—ç”¨æˆ·æ‹’ç»ç‚¹æˆæƒ å¼€å‘è€…æ•¢æ€’ä¸æ•¢è¨€å…ˆè¯´ä¸‹å°ç¨‹åºç”¨æˆ·ç™»å½•æˆæƒçš„æµç¨‹ï¼Œæ‹¿ä¸€å¼ å®˜æ–¹çš„æ—¶åºå›¾wx.login ã€è¯·æ³¨æ„æ­¤å¤„ä¸éœ€ç”¨æˆ·æˆæƒã€‘è°ƒç”¨æ¥å£è·å–ç™»å½•å‡­è¯ï¼ˆcodeï¼‰è¿›è€Œæ¢å–ç”¨æˆ·ç™»å½•æ€ä¿¡æ¯é‡ç‚¹è¯´ä¸€å“ˆåŸç†æ˜¯è°ƒç”¨wx.loginè·å–ä¸€ä¸ªç”¨æˆ·ç™»å½•å‡­è¯codeåˆ°åå°äº¤æ¢ï¼Œç„¶åä¼šè·å¾—openidã€session_key,å¾®ä¿¡ä¸å»ºè®®openidä½œä¸ºkey,æˆ‘æ˜¯ç”¨uuidä½œä¸ºkeyï¼Œopenidå’Œsession_keyæ”¾åˆ°mapé‡Œä½œä¸ºvalueï¼Œç„¶åæ”¾è¿›redisï¼Œè®¾ç½®ä¸€ä¸ªä¸è¦å¤ªé•¿çš„è¿‡æœŸæ—¶é—´ï¼Œç„¶åæŠŠkeyä½œä¸º3rd_sessionä¼ ç»™å°ç¨‹åºç«¯ã€‚ javaçš„ç«¥é‹åå°æ¥å£æ¨èä¸ªè´¼å¥½ç”¨çš„sdk=&amp;gt;å¯èƒ½æ˜¯ç›®å‰æœ€å¥½æœ€å…¨çš„å¾®ä¿¡Javaå¼€å‘å·¥å…·åŒ…ï¼ˆSDKï¼‰ public String login(String code) { if (StringUtils.isBlank(code)) { return &quot;empty jscode&quot;; } try { //äº¤æ¢code WxMaJscode2SessionResult session = this.wxService.getUserService() .getSessionInfo(code); String thirdSession = TokenGenerator.generateValue(); Map&amp;lt;String, Object&amp;gt; val = new HashMap&amp;lt;String, Object&amp;gt;(); val.put(&quot;openid&quot;, session.getOpenid()); val.put(&quot;sessionkey&quot;, session.getSessionKey()); //å­˜å‚¨åˆ°redis redisUtils.set(thirdSession, val,session.getExpiresin()); //TODO æ­¤å¤„å¯ä»¥æ ¹æ®ä¸šåŠ¡è¿›è¡Œæ“ä½œ //è¿”å›3rdSessionç»™å°ç¨‹åº return JsonUtils.toJson(thirdSession); } catch (WxErrorException e) { this.logger.error(e.getMessage(), e); return e.toString(); } } å°ç¨‹åºæŠŠè¿™ä¸ªå€¼å­˜å‚¨åˆ°æœ¬åœ°ï¼Œæ¯æ¬¡è¯·æ±‚å¤´æ–‡ä»¶å¸¦ä¸Šè¿™ä¸ª3rd_sessionï¼Œåå°åšæ ¡éªŒã€‚ // ç™»å½• wx.login({ success: res =&amp;gt; { // å‘é€ res.code åˆ°åå°æ¢å– openId, sessionKey, unionId console.log(res.code) if (res.code) { //å‘èµ·ç½‘ç»œè¯·æ±‚ wx.request({ url: &#39;xxxxxxx&#39;, data: { code: res.code }, success: function (res) { wx.setStorageSync(&#39;3rdSession&#39;, res.data) } }) } else { console.log(&#39;è·å–ç”¨æˆ·ç™»å½•æ€å¤±è´¥ï¼&#39; + res.errMsg) } } })è¿‡æœŸæ—¶é—´redisçš„æ˜¯æœåŠ¡å™¨çš„sessionè¿‡æœŸæ—¶é—´ï¼Œä¿è¯ç”¨æˆ·å…³é—­å°ç¨‹åºåsessionå¤±æ•ˆå³å®‰å…¨æ€§,åŒæ—¶å¾®ä¿¡codeå’Œå¾®ä¿¡æœåŠ¡å™¨æ¢å–çš„session_keyä¹Ÿæœ‰è¿‡æœŸæ—¶é—´ï¼Œè¦ç”¨åˆ°ä¸‹æ–‡çš„wx.checkSessionæ¥åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œé‡æ–°è°ƒç”¨wx.loginè·å–_wx.checkSession é€šè¿‡ä¸Šè¿°æ¥å£è·å¾—çš„ç”¨æˆ·ç™»å½•æ€æ‹¥æœ‰ä¸€å®šçš„æ—¶æ•ˆæ€§ã€‚ç”¨æˆ·è¶Šä¹…æœªä½¿ç”¨å°ç¨‹åºï¼Œç”¨æˆ·ç™»å½•æ€è¶Šæœ‰å¯èƒ½å¤±æ•ˆã€‚åä¹‹å¦‚æœç”¨æˆ·ä¸€ç›´åœ¨ä½¿ç”¨å°ç¨‹åºï¼Œåˆ™ç”¨æˆ·ç™»å½•æ€ä¸€ç›´ä¿æŒæœ‰æ•ˆã€‚å…·ä½“æ—¶æ•ˆé€»è¾‘ç”±å¾®ä¿¡ç»´æŠ¤ï¼Œå¯¹å¼€å‘è€…é€æ˜ã€‚å¼€å‘è€…åªéœ€è¦è°ƒç”¨wx.checkSessionæ¥å£æ£€æµ‹å½“å‰ç”¨æˆ·ç™»å½•æ€æ˜¯å¦æœ‰æ•ˆã€‚ç™»å½•æ€è¿‡æœŸåå¼€å‘è€…å¯ä»¥å†è°ƒç”¨wx.loginè·å–æ–°çš„ç”¨æˆ·ç™»å½•æ€wx.checkSession({ success: function(){ //session æœªè¿‡æœŸï¼Œå¹¶ä¸”åœ¨æœ¬ç”Ÿå‘½å‘¨æœŸä¸€ç›´æœ‰æ•ˆ }, fail: function(){ //ç™»å½•æ€è¿‡æœŸ wx.login() //é‡æ–°ç™»å½• .... }})wx.getUserInfo (æ­¤å¤„ä¼šå¼¹å‡ºæˆæƒçª—å£)æœ€æ¶å¿ƒçš„æ¥äº†ï¼Œç”¨æˆ·ä¸€æ—¦æ‹’ç»æˆæƒï¼Œè¦ç­‰10åˆ†é’Ÿæˆ–è€…åˆ é™¤å°ç¨‹åºé‡æ–°æ‰“å¼€æ‰èƒ½æˆæƒã€‚å‰è¾ˆä»¬æ€»ç»“äº†å¥½å‡ å¥—æ–¹æ¡ˆæ¯”å¦‚æ— é™å¼¹æˆæƒã€é¦–é¡µæç¤ºæˆæƒï¼Œé¹…å‚çˆ¸çˆ¸å½“ç„¶ä¸ç»™è¿™ä¹ˆæäº†ï¼Œç”¨æˆ·ä½“éªŒæœ€é«˜ã€‚å¾®ä¿¡å‘å¸ƒäº†ä¸€ä¸ªå…¬å‘Š: ä¸ºäº†ç»™ç”¨æˆ·æä¾›æ›´å¥½çš„å°ç¨‹åºç¯å¢ƒï¼Œæˆ‘ä»¬çº¦å®šåœ¨ä¸€æ®µæ—¶é—´åï¼ˆå…·ä½“æ—¶é—´ä¼šåšé€šçŸ¥ï¼‰ï¼Œè‹¥è¿˜å‡ºç°ä»¥ä¸‹æƒ…å†µ&amp;gt;ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºï¼‰ï¼Œå°†æ— æ³•é€šè¿‡å®¡æ ¸ åˆæ¬¡æ‰“å¼€å°ç¨‹åºå°±å¼¹æ¡†æˆæƒç”¨æˆ·ä¿¡æ¯ã€‚ æœªå¤„ç†ç”¨æˆ·æ‹’ç»æˆæƒçš„æƒ…å†µã€‚ å¼ºåˆ¶è¦æ±‚ç”¨æˆ·æˆæƒã€‚ æœ€å¥½çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨éœ€è¦è°ƒç”¨æˆæƒçš„åœ°æ–¹è°ƒç”¨,å¦‚æœç”¨æˆ·æ‹’ç»ï¼Œå¼¹å‡ºæç¤ºè­¦å‘Šæ— æ³•ä½¿ç”¨éƒ¨åˆ†åŠŸèƒ½,ä»¥ä¸‹ä»£ç å¼¹å‡ºæˆæƒè®¾ç½®æ¡† // è·å–ç”¨æˆ·ä¿¡æ¯ wx.getSetting({ success: res =&amp;gt; { console.log(res.authSetting[&#39;scope.userInfo&#39;]) if (res.authSetting[&#39;scope.userInfo&#39;]) { // å·²ç»æˆæƒï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ getUserInfo è·å–å¤´åƒæ˜µç§°ï¼Œä¸ä¼šå¼¹æ¡† wx.getUserInfo({ success: res =&amp;gt; { // å¯ä»¥å°† res å‘é€ç»™åå°è§£ç å‡º unionId this.globalData.userInfo = res.userInfo // ç”±äº getUserInfo æ˜¯ç½‘ç»œè¯·æ±‚ï¼Œå¯èƒ½ä¼šåœ¨ Page.onLoad ä¹‹åæ‰è¿”å› // æ‰€ä»¥æ­¤å¤„åŠ å…¥ callback ä»¥é˜²æ­¢è¿™ç§æƒ…å†µ if (this.userInfoReadyCallback) { this.userInfoReadyCallback(res) } } }) } } })è§£å¯†æ•æ„Ÿä¿¡æ¯wx.getUserInfo å‚æ•°å ç±»å‹ å¿…å¡« è¯´æ˜ withCredentials Boolean å¦ æ˜¯å¦å¸¦ä¸Šç™»å½•æ€ä¿¡æ¯ è·å–ç”¨æˆ·ä¿¡æ¯ï¼ŒwithCredentials ä¸º true æ—¶éœ€è¦å…ˆè°ƒç”¨ wx.login æ¥å£ã€‚æ­¤å‚æ•°é»˜è®¤ä¸ºfalseï¼Œå¯ä»¥ç›´æ¥è·å–å¤´åƒã€æ˜µç§°ç­‰éæ•æ„Ÿä¿¡æ¯ï¼Œæ•æ„Ÿä¿¡æ¯å¯ä»¥è·å–åˆ°åœ°ç†ä¿¡æ¯ç­‰ã€‚æš‚æ—¶è¿˜æœªç”¨åˆ°ï¼Œå¾…ç»­â€¦å‚è€ƒåœ°å€ï¼šhttps://my.oschina.net/mrlingli/blog/873263http://www.ifanr.com/minapp/886723https://www.cnblogs.com/nosqlcoco/p/6105749.html" }, { "title": "angular-cli æ‰“åŒ…æ–‡ä»¶è¿‡å¤§è§£å†³æ–¹æ¡ˆ", "url": "/posts/angular-cli-%E6%89%93%E5%8C%85%E6%96%87%E4%BB%B6%E8%BF%87%E5%A4%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/", "categories": "", "tags": "angular", "date": "2018-01-10 21:53:29 +0800", "snippet": "å†™å¥½çš„angularç½‘ç«™é¦–é¡µè®¿é—®é€Ÿåº¦å¾ˆæ…¢ï¼Œæ¢ç©¶ä¸€ç•ªå‘ç°é—®é¢˜æ‰€åœ¨å¹¶è§£å†³ng buildç”Ÿæˆæ–‡ä»¶è¿‡å¤§å¯ä»¥çœ‹åˆ°5.4Mï¼Œè®¿é—®æ—¶é—´è¾¾åˆ°äº†12sï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ä»€ä¹ˆä¾èµ–è¿‡å¤§ï¼Œåæ¥å‘ç°ä¸ç»è¿‡å‹ç¼©ç”Ÿæˆçš„æ–‡ä»¶å°±æ˜¯è¿™ä¹ˆå¤§ã€‚è§£å†³æ–¹æ¡ˆï¼š1.é…åˆå‘½ä»¤å‹ç¼©æ‰“åŒ… ng build --prod --aot --build-optimizer 2.å†é…åˆnginxå¼€å¯gzipå‹ç¼© å¯ä»¥çœ‹åˆ°æœ€åæ–‡ä»¶åªæœ‰400kbå¤§å°ï¼Œè®¿é—®é€Ÿåº¦è¾¾åˆ°æœ€å¿«æœ€åæ„Ÿè°¢pcroboté“å‹ä¸€åŒè§£å†³é—®é¢˜" }, { "title": "springboot å¼•ç”¨ç¬¬ä¸‰æ–¹jaråŒ…ä»¥åŠæ‰“åŒ…", "url": "/posts/springboot-%E5%BC%95%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9jar%E5%8C%85%E4%BB%A5%E5%8F%8A%E6%89%93%E5%8C%85/", "categories": "", "tags": "java, maven, springboot, jar", "date": "2018-01-10 00:33:11 +0800", "snippet": "é¡¹ç›®springbootæ¶æ„ï¼Œmavenæ‰“åŒ…éœ€è¦waråŒ…ç”±äºä¸šåŠ¡éœ€è¦ä½¿ç”¨é©¬äº‘çˆ¸çˆ¸çš„jaråŒ…ï¼Œè€Œä»–çš„jaråŒ…æ˜¯æ ¹æ®ç”¨æˆ·æƒé™åŠæ—¶ç”Ÿæˆçš„ï¼Œæ‰€ä»¥ä¸­å¤®mavenåº“æ²¡æœ‰ã€‚ç™¾åº¦è°·æ­Œä¸€ç•ªï¼Œæœ¬åœ°ä½¿ç”¨æ²¡æœ‰é—®é¢˜ï¼Œå¼•ç”¨ä»£ç å¦‚ä¸‹ï¼š&amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;org.miemie.analyzer&amp;lt;/groupId&amp;gt; &amp;lt;!-- éšæ„--&amp;gt; &amp;lt;artifactId&amp;gt;tbk&amp;lt;/artifactId&amp;gt; &amp;lt;!-- éšæ„--&amp;gt; &amp;lt;version&amp;gt;1.0&amp;lt;/version&amp;gt; &amp;lt;!-- éšæ„--&amp;gt; &amp;lt;scope&amp;gt;system&amp;lt;/scope&amp;gt; &amp;lt;!-- /system è¡¨ç¤ºä¸è¯»å–æœ¬åœ°ä»“åº“ï¼Œè¯»å–æŒ‡å®šç³»ç»Ÿæ–‡ä»¶ï¼Œé»˜è®¤ä¸ºcompileï¼ˆç¼–è¯‘æµ‹è¯•æ‰“åŒ…éƒ½ä¼šæ”¾è¿›å»ï¼‰--&amp;gt; &amp;lt;systemPath&amp;gt;${project.basedir}/lib/xxxx.jar &amp;lt;!-- srcåŒçº§ç›®å½•æ–°å»ºä¸€ä¸ªlibæ–‡ä»¶å¤¹ï¼Œå°†éœ€è¦çš„jaråŒ…æ‰”è¿›å»--&amp;gt; &amp;lt;/systemPath&amp;gt;&amp;lt;/dependency&amp;gt; é—®é¢˜ä¸»è¦åœ¨æ‰“åŒ…ï¼Œå¦‚æœæ­£å¸¸æ‰“åŒ…éƒ¨ç½²ï¼ŒæœåŠ¡å™¨ä¼šæŠ¥nosuchclassé”™è¯¯ï¼Œå› ä¸ºæ²¡æ‰“è¿›å»å•Š,é‚£ä¹ˆå°±è¦è§£å†³ç¬¬ä¸‰æ–¹jaråŒ…æ— æ³•æ‰“å…¥çš„é—®é¢˜æ‰“åŒ…å¤§è‡´æœ‰å‡ ç§è§£å†³æ–¹æ³•ï¼š æœ¬åœ°å®‰è£…jaråŒ…åˆ°mavenä»“åº“ï¼Œç›´æ¥å¼•ç”¨ï¼Œä¸ç”¨åƒä¸Šé¢ä»£ç ä¸€æ ·å†™èŒƒå›´å’Œè·¯å¾„äº†ã€‚ç®€å•ç²—æš´ï¼Œæ‰“jar/waråŒ…éƒ½å¯ä»¥ï¼Œä½†æ˜¯ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œæ¯å°ç”µè„‘éƒ½éœ€è¦å®‰è£…ä¸€éã€‚ ç»Ÿä¸€é…ç½® (åŒ…æ‹¬æ‰“jarå’ŒwaråŒ…)ï¼Œè¿™æ ·ä¸ç”¨æ¯å°pullé¡¹ç›®çš„æœºå™¨éƒ½å®‰è£…jaråŒ… æ‰“jaråŒ…ï¼Œåœ¨pomæ–‡ä»¶ä¸­çš„buildæ ‡ç­¾ä¸‹åŠ ä¸Šå¦‚ä¸‹çš„é…ç½®```xml org.springframework.boot spring-boot-maven-plugin ${project.basedir}/lib BOOT-INF/lib/ **/*.jar src/main/resources BOOT-INF/classes/ + æ‰“waråŒ…ï¼Œè¦ç”¨åˆ°maven-war-plugin æ’ä»¶```xml&amp;lt;plugin&amp;gt; &amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;maven-war-plugin&amp;lt;/artifactId&amp;gt; &amp;lt;configuration&amp;gt; &amp;lt;webResources&amp;gt; &amp;lt;resource&amp;gt; &amp;lt;directory&amp;gt;${project.basedir}/lib&amp;lt;/directory&amp;gt; &amp;lt;targetPath&amp;gt;WEB-INF/lib/&amp;lt;/targetPath&amp;gt; &amp;lt;includes&amp;gt; &amp;lt;!-- æŠŠæ‰€æœ‰libä¸‹çš„jaråŒ…æ‰“è¿›WEB-INF/libé‡Œé¢--&amp;gt; &amp;lt;include&amp;gt;**/*.jar&amp;lt;/include&amp;gt; &amp;lt;/includes&amp;gt; &amp;lt;/resource&amp;gt; &amp;lt;/webResources&amp;gt; &amp;lt;/configuration&amp;gt; &amp;lt;/plugin&amp;gt; è‡³æ­¤ï¼Œåº”è¯¥éƒ½å¯ä»¥æ„‰å¿«çš„ç©è€äº†ï¼ŒæŠŠä½ çš„jar/waråŒ…ä¸¢åˆ°æœåŠ¡å™¨å§ã€‚" }, { "title": "2018/1/4 å—äº¬åˆé›ª", "url": "/posts/%E5%8D%97%E4%BA%AC%E5%88%9D%E9%9B%AA/", "categories": "", "tags": "éšç¬”", "date": "2018-01-04 16:38:30 +0800", "snippet": "ç›—ä¸ªå›¾å…ˆâ…é›ªâ…è·¯ä¸Šå„ç§æ ‘ç»™å‹åŠˆå‰ï¼Œéª‘ç€å°ç”µé©´ä¸€è·¯æ¼‚ç§»åˆ°äº†åœ°é“ç«™ é›¾å‡‡æ²†ç €ï¼Œå¤©ä¸äº‘ä¸å±±ä¸æ°´ï¼Œä¸Šä¸‹ä¸€ç™½ã€‚æ¹–ä¸Šå½±å­ï¼ŒæƒŸé•¿å ¤ä¸€ç—•ã€æ¹–å¿ƒäº­ä¸€ç‚¹ã€ä¸ä½™èˆŸä¸€èŠ¥ã€èˆŸä¸­äººä¸¤ä¸‰ç²’è€Œå·²ã€‚èµ°çš„ä¹Ÿä¸ç®—æ™šå§ï¼Œéƒ½æ˜¯æ‰«é›ªçš„äººï¼Œå®Œå…¨æ²¡æœ‰ä»¥ä¸Šçš„æ„å¢ƒã€‚è¿™ç§å¤©ï¼Œåœ¨å®¶æ‚è¢«çªæ‰æ˜¯æå¥½çš„ XD" } ]
